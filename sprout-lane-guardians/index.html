<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="game-id" content="sprout-lane-guardians"><meta name="game-version" content="0.1.0"><title>Sprout Lane Guardians</title><style>:root{--ink:#27402f;--panel:#fffef8;--line:#b8dcc4;--mint:#a8f0cf;--sky:#a5deff;--pink:#ff96c6;--sun:#ffe38a;--danger:#ff8b8b;--gold:#cb9f28;--silver:#8897a6;--bronze:#9d6c48}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body,html{overscroll-behavior:none}body{margin:0;min-height:100vh;color:var(--ink);background:radial-gradient(circle at 15% 10%,#fffadf 0,transparent 34%),radial-gradient(circle at 84% 18%,#ffeaf6 0,transparent 32%),linear-gradient(180deg,#c9f4ff 0,#f1ffe8 55%,#f7f5df 100%);font-family:"Baloo 2",Nunito,"Trebuchet MS",sans-serif;display:flex;justify-content:center;overflow:hidden;touch-action:none;user-select:none}.app{width:min(100vw,540px);padding:10px;padding-top:calc(14px + env(safe-area-inset-top));padding-bottom:calc(14px + env(safe-area-inset-bottom))}.topbar{display:grid;grid-template-columns:1fr 1fr 1fr 1fr auto auto;gap:8px;margin-bottom:8px}.pill{border:2px solid var(--line);border-radius:12px;background:#ffffffdb;text-align:center;font-size:13px;font-weight:800;padding:8px 4px}button{border:none;border-radius:12px;padding:10px 10px;font-weight:800;font-size:14px;background:#57bf93;color:#fff;cursor:pointer}#arenaWrap{position:relative;border:3px solid #8ec8a8;border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#99d9ff 0,#f7ffe9 100%);box-shadow:inset 0 -30px 110px rgba(49,80,52,.22);touch-action:none}canvas{width:100%;height:auto;display:block;touch-action:none}.hint{min-height:18px;text-align:center;margin-top:6px;font-size:13px;font-weight:700;opacity:.95}.tutorial-banner{margin-top:6px;min-height:34px;border:2px solid #bde7cb;border-radius:12px;background:#f7fff3;display:none;align-items:center;justify-content:center;text-align:center;padding:6px 10px;font-size:13px;font-weight:800;color:#256047}.tutorial-banner.show{display:flex}.controls{margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px}.pad{display:grid;grid-template-columns:1fr 1fr;gap:8px}.btn-big{min-height:56px;font-size:19px;border:2px solid #3f8d6d;background:#66ca9f}.btn-center{min-height:56px;font-size:17px;border:2px solid #3f8d6d;background:#4fb98d}.modal,.overlay{position:fixed;inset:0;background:rgba(24,41,29,.52);display:none;align-items:center;justify-content:center;padding:14px;z-index:12}.modal.show,.overlay.show{display:flex}.panel{width:min(100%,470px);background:var(--panel);border-radius:14px;border:2px solid #cee7d6;padding:14px}.panel h2{margin:0 0 8px;font-size:22px}.row{display:flex;align-items:center;gap:8px}.row-end{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}input[type=text]{flex:1;border:2px solid #d4ebdd;border-radius:10px;padding:8px;font-size:14px;min-width:0}.lb-list{list-style:none;margin:10px 0;padding:0;border:1px solid #e4f0e8;border-radius:10px;max-height:280px;overflow:auto;background:#fdfffd}.lb-item{display:grid;grid-template-columns:34px 1fr auto;gap:8px;padding:7px 10px;border-bottom:1px solid #edf7f0;font-size:14px}.lb-item:last-child{border-bottom:none}.rank-1{color:var(--gold);font-weight:800}.rank-2{color:var(--silver);font-weight:800}.rank-3{color:var(--bronze);font-weight:800}.my-rank{font-size:14px;background:#f4ffec;border:2px solid #c8efb6;border-radius:10px;padding:8px 10px}@media (max-width:420px){.topbar{grid-template-columns:1fr 1fr 1fr auto auto}.pill.small-hide{display:none}}</style></head><body><div class="app"><div class="topbar"><div class="pill">Snack <span id="zoneLabel">1</span>/10</div><div class="pill">Party <span id="party">3</span></div><div class="pill">Purify <span id="purify">12</span></div><div class="pill small-hide">Power <span id="power">36</span></div><button id="topBtn">Top</button> <button id="restartBtn">Restart</button></div><div id="arenaWrap"><canvas id="arena" width="420" height="760" aria-label="game field"></canvas></div><div id="hint" class="hint">Drag/tap lane to dodge and collect. Purify cute troublemakers.</div><div id="tutorialBanner" class="tutorial-banner"></div><div class="controls"><div class="pad"><button id="leftBtn" class="btn-big">◀</button> <button id="rightBtn" class="btn-big">▶</button></div><button id="centerBtn" class="btn-center">CENTER</button></div></div><div id="reviveOverlay" class="overlay"><div class="panel"><h2>Revive once?</h2><p id="reviveText">Use rewarded ad in wrapper to continue from checkpoint.</p><div class="row"><button id="reviveBtn">Revive</button> <button id="skipReviveBtn" style="background:#ca6666">No Thanks</button></div></div></div><div id="gameOverOverlay" class="overlay"><div class="panel"><h2 id="resultTitle">Run Ended</h2><p>Score: <strong id="finalScore">0</strong></p><p>Duration: <strong id="finalTime">0.00s</strong></p><p id="resultDetail">Keep collecting growth items before boss.</p><div class="row"><button id="playAgainBtn">Play Again</button></div></div></div><div id="leaderboardModal" class="modal"><div class="panel"><h2>Global Top 10</h2><div id="latestRun" class="my-rank" style="display:none;margin-bottom:8px"></div><div class="row"><input id="nickInput" maxlength="20" disabled="disabled"> <button id="changeNickBtn">Change</button> <button id="saveNickBtn" style="display:none">Save</button></div><ul id="lbList" class="lb-list"></ul><div id="myRank" class="my-rank">My Rank: -</div><div class="row-end"><button id="closeLbBtn">Close</button></div></div></div><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script><script>!function(){"use strict";const e="sprout-lane-guardians",t=e+":nick",n=e+":best",a=e+":interstitial:last",i=e+":tutorialSeen",l=420,o=760,s=638,r=[106,210,314],c=2460,f=940,d=[0,820,1640,c],u=[{name:"솜젤리",dmg:12},{name:"딸기쿠키",dmg:16},{name:"허니마카롱",dmg:21},{name:"카라멜롤",dmg:27},{name:"초코번",dmg:34},{name:"민트파이",dmg:42},{name:"레인보우캔디",dmg:51},{name:"크림도넛",dmg:61},{name:"슈가타르트",dmg:72},{name:"별사탕코어",dmg:84}],m=[{d:560,left:{label:"+2 THROWERS",effect:function(){L.party+=2,N("Throwers +2","#66ca9f")}},right:{label:"SNACK LV +1",effect:function(){L.snackLevel=Math.min(10,L.snackLevel+1),N("Snack Lv Up!","#7cbcff")}}},{d:1180,left:{label:"+3 THROWERS",effect:function(){L.party+=3,N("Throwers +3","#66ca9f")}},right:{label:"SNACK LV +1",effect:function(){L.snackLevel=Math.min(10,L.snackLevel+1),N("Snack Lv Up!","#7cbcff")}}},{d:1760,left:{label:"+4 THROWERS",effect:function(){L.party+=4,N("Throwers +4","#66ca9f")}},right:{label:"SNACK LV +2",effect:function(){L.snackLevel=Math.min(10,L.snackLevel+2),N("Snack Lv Big Up!","#7cbcff")}}}],p=900,h=1700,y=8,v="#ff7fb5",g="#ffe27a",k="#78a15d",b="#ff8b8b",M="#7a6ae5",S={arena:document.getElementById("arena"),zoneLabel:document.getElementById("zoneLabel"),party:document.getElementById("party"),purify:document.getElementById("purify"),power:document.getElementById("power"),hint:document.getElementById("hint"),tutorialBanner:document.getElementById("tutorialBanner"),topBtn:document.getElementById("topBtn"),restartBtn:document.getElementById("restartBtn"),leftBtn:document.getElementById("leftBtn"),rightBtn:document.getElementById("rightBtn"),centerBtn:document.getElementById("centerBtn"),reviveOverlay:document.getElementById("reviveOverlay"),reviveText:document.getElementById("reviveText"),reviveBtn:document.getElementById("reviveBtn"),skipReviveBtn:document.getElementById("skipReviveBtn"),gameOverOverlay:document.getElementById("gameOverOverlay"),resultTitle:document.getElementById("resultTitle"),resultDetail:document.getElementById("resultDetail"),finalScore:document.getElementById("finalScore"),finalTime:document.getElementById("finalTime"),playAgainBtn:document.getElementById("playAgainBtn"),leaderboardModal:document.getElementById("leaderboardModal"),lbList:document.getElementById("lbList"),myRank:document.getElementById("myRank"),latestRun:document.getElementById("latestRun"),nickInput:document.getElementById("nickInput"),changeNickBtn:document.getElementById("changeNickBtn"),saveNickBtn:document.getElementById("saveNickBtn"),closeLbBtn:document.getElementById("closeLbBtn")},x=S.arena.getContext("2d"),L={running:!1,modalOpen:!1,awaitingRevive:!1,reviveUsed:!1,elapsedMs:0,score:0,best:Number(localStorage.getItem(n)||0),distance:0,checkpointDistance:0,lane:1,laneVisual:1,checkpointLane:1,party:3,purify:12,snackLevel:1,snackExp:0,fireTimer:0,mobTimer:0,projectiles:[],mobs:[],mobsDefeated:0,hitFlash:0,startedSent:!1,tutorial:{active:!1,elapsed:0,step:0},objects:[],gates:[],popups:[],purifiedCount:0,itemScore:0,enemyScore:0,boss:{active:!1,hp:h,timer:0,resolved:!1,lastDps:0},lastFrame:0,db:null,uid:null,nick:"",nickKeyLower:"",latestSubmitted:null};function B(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ",t="23456789";return"Sprout"+e[Math.floor(24*Math.random())]+t[Math.floor(8*Math.random())]+t[Math.floor(8*Math.random())]}function w(e,t){const n=JSON.stringify({type:e,payload:t||{}});window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage&&window.ReactNativeWebView.postMessage(n)}function I(){return 28}function E(){return u[L.snackLevel-1].dmg}function R(){return Math.max(.12,.42-.02*(L.snackLevel-1))}function T(){const e=Math.max(0,Math.floor(L.party)-1),t=Math.min(6,e),n=[{x:0,y:.95*-28}];for(let e=0;e<t;e++){const t=33.6*(e%3-1),a=43.4+Math.floor(e/3)*(28*1.1);n.push({x:t,y:a-25.2})}return n}function P(e){return e<d[1]?1:e<d[2]?2:3}function N(e,t){L.popups.push({text:e,color:t||"#ffffff",t:0,y:592}),L.popups.length>6&&L.popups.shift()}function C(e){return Math.floor(.72*L.distance)+L.itemScore+L.enemyScore+40*L.purifiedCount+Math.floor(65*L.party)+Math.floor(12*L.purify)+(e||0)}function D(e){L.lane=Math.max(0,Math.min(2,e))}function A(){if(!L.tutorial.active)return S.tutorialBanner.classList.remove("show"),void(S.tutorialBanner.textContent="");S.tutorialBanner.classList.add("show"),0===L.tutorial.step?S.tutorialBanner.textContent="Tutorial 1/3: 좌우로 이동해서 젤리를 먹어보세요":1===L.tutorial.step?S.tutorialBanner.textContent="Tutorial 2/3: 씨앗을 먹어 동료 수를 늘리세요":S.tutorialBanner.textContent="Tutorial 3/3: 자동 투척 전투로 몹을 정화하세요"}function O(){L.running=!0,L.modalOpen=!1,L.awaitingRevive=!1,L.reviveUsed=!1,L.elapsedMs=0,L.score=0,L.distance=0,L.checkpointDistance=0,L.lane=1,L.laneVisual=1,L.checkpointLane=1,L.party=3,L.purify=12,L.snackLevel=1,L.snackExp=0,L.fireTimer=0,L.mobTimer=0,L.projectiles=[],L.mobs=[],L.mobsDefeated=0,L.hitFlash=0,L.purifiedCount=0,L.itemScore=0,L.enemyScore=0,L.startedSent=!1,L.tutorial.active="1"!==localStorage.getItem(i),L.tutorial.elapsed=0,L.tutorial.step=0,L.objects=function(){const e=function(){let e=20260222%2147483647;return e<=0&&(e+=2147483646),function(){return e=16807*e%2147483647,(e-1)/2147483646}}(),t=[];for(let n=180;n<2180;n+=65+Math.floor(46*e())){if(m.some(function(e){return Math.abs(e.d-n)<90}))continue;const a=Math.floor(3*e()),i=e();i<.52?t.push({kind:"jelly",lane:a,d:n,taken:!1}):i<.74?t.push({kind:"seed",lane:a,d:n,taken:!1}):t.push({kind:"thorn",lane:a,d:n,taken:!1})}for(let e=0;e<8;e++){const n=230+260*e;t.push({kind:"jelly",lane:e%3,d:n,taken:!1}),t.push({kind:"jelly",lane:(e+1)%3,d:n+26,taken:!1})}if(L.tutorial.active){t.push({kind:"jelly",lane:0,d:170,taken:!1}),t.push({kind:"jelly",lane:1,d:210,taken:!1}),t.push({kind:"seed",lane:2,d:290,taken:!1}),t.push({kind:"seed",lane:1,d:340,taken:!1});for(let e=0;e<t.length;e++)t[e].d<560&&"thorn"===t[e].kind&&(t[e].kind=e%2==0?"jelly":"seed")}return t.sort(function(e,t){return e.d-t.d}),t}(),L.gates=m.map(function(e){return{d:e.d,left:e.left,right:e.right,applied:!1}}),L.popups=[],L.boss.active=!1,L.boss.hp=h,L.boss.timer=0,L.boss.resolved=!1,L.boss.lastDps=0,L.lastFrame=0,S.reviveOverlay.classList.remove("show"),S.gameOverOverlay.classList.remove("show"),S.latestRun.style.display="none",S.hint.textContent="젤리로 간식 업그레이드, 씨앗으로 투척 동료 추가",A(),V(),w("GAME_START",{}),L.startedSent=!0}function V(){const e=Math.round(Math.max(1,L.party*(4+2*L.snackLevel)+L.purify)),t=p;S.zoneLabel.textContent=String(L.snackLevel),S.party.textContent=String(Math.max(0,Math.floor(L.party))),S.purify.textContent=String(Math.round(L.purify)),S.power.textContent=String(e),L.tutorial.active?S.hint.textContent="젤리는 간식 경험치, 씨앗은 투척 동료 증가입니다":L.boss.active?S.hint.textContent="보스전: "+u[L.snackLevel-1].name+" 투척 중! (파워 "+e+" / 권장 "+t+")":S.hint.textContent=e<.55*t?"간식 Lv "+L.snackLevel+" ("+u[L.snackLevel-1].name+"), 젤리/씨앗으로 성장하세요":"좋아요! 몹을 간식으로 약화시키며 보스로 이동하세요"}function j(e){L.reviveUsed?F(!1,e||"Failed to stabilize the forest."):(L.running=!1,L.awaitingRevive=!0,L.modalOpen=!0,S.reviveText.textContent="Revive from checkpoint and recover your sprout team.",S.reviveOverlay.classList.add("show"))}function F(e,t){L.running=!1,L.awaitingRevive=!1,L.modalOpen=!1,S.reviveOverlay.classList.remove("show"),S.gameOverOverlay.classList.add("show");const i=Math.max(1,Math.round(L.elapsedMs)),l=C(e?1400:0);e?(S.resultTitle.textContent="Forest Restored",S.resultDetail.textContent=t||"Boss purified. Sparkles everywhere."):(S.resultTitle.textContent="Run Ended",S.resultDetail.textContent=t||"Collect better gates and avoid thorn hits."),L.score=l,L.latestSubmitted={score:l,durationMs:i},S.finalScore.textContent=String(l),S.finalTime.textContent=(i/1e3).toFixed(2)+"s",S.latestRun.style.display="block",S.latestRun.textContent="Latest run: "+l+" points in "+(i/1e3).toFixed(2)+"s",l>L.best&&(L.best=l,localStorage.setItem(n,String(l))),w("GAME_OVER",{score:l,durationMs:i}),function(){try{const e=Date.now(),t=Number(localStorage.getItem(a)||0);return!(t&&e-t<35e3||(localStorage.setItem(a,String(e)),0))}catch(e){return!1}}()&&w("REQUEST_INTERSTITIAL",{reason:"run_completed"}),G(l,i,!1)}function _(e){e[L.lane<=1?"left":"right"].effect(),e.applied=!0,L.checkpointDistance=e.d+20,L.checkpointLane=L.lane}function W(e){if(e.taken=!0,"jelly"===e.kind){L.snackExp+=1;const e=2*L.snackLevel;return L.snackLevel<10&&L.snackExp>=e&&(L.snackExp=0,L.snackLevel+=1,N("Snack Lv "+L.snackLevel+"!","#9dd4ff")),L.itemScore+=55,void N("Snack EXP +1",v)}if("seed"===e.kind){const e=1;return L.party+=e,L.itemScore+=90,void N("Party +"+e,g)}if("thorn"===e.kind)return L.party-=1,L.purify=Math.max(5,L.purify-3),L.hitFlash=.25,void N("Ouch",b)}function U(e){if(!L.running||L.modalOpen)return;L.elapsedMs+=1e3*e,L.tutorial.active&&(L.tutorial.elapsed+=e,L.tutorial.elapsed<2.5?L.tutorial.step=0:L.tutorial.elapsed<5?L.tutorial.step=1:L.tutorial.step=2,A(),L.tutorial.elapsed>=8&&(L.tutorial.active=!1,localStorage.setItem(i,"1"),A())),L.hitFlash>0&&(L.hitFlash=Math.max(0,L.hitFlash-e)),L.laneVisual+=(L.lane-L.laneVisual)*Math.min(1,14*e),L.fireTimer+=e,L.fireTimer>=R()&&(L.fireTimer=0,function(){const e=r[0]+(r[2]-r[0])*(L.laneVisual/2),t=T(),n=L.snackLevel;for(let a=0;a<t.length;a++)L.projectiles.push({x:e+t[a].x,y:638+t[a].y,vy:410+20*n+3*a,dmg:E(),tier:n,r:5+.6*n})}()),L.mobTimer+=e;const t=L.boss.active?.72:Math.max(.42,.95-.04*L.snackLevel);if(L.mobTimer>=t&&(L.mobTimer=0,function(){const e=Math.floor(3*Math.random()),t=30+8*L.snackLevel+9*P(L.distance);L.mobs.push({lane:e,x:r[e],y:-30,hp:t,maxHp:t,speed:68+45*Math.random()+7*P(L.distance)})}()),!L.boss.active){const t=196+14*P(L.distance);L.distance+=t*e;for(let e=0;e<L.gates.length;e++){const t=L.gates[e];!t.applied&&L.distance>=t.d-6&&_(t)}for(let e=0;e<L.objects.length;e++){const t=L.objects[e];t.taken||(Math.abs(t.d-L.distance)>20||Math.abs(t.lane-L.laneVisual)>.45||W(t))}if(L.party<=0)return void j("Your sprout party ran out.");L.distance>=c&&(L.boss.active=!0,L.boss.hp=h,L.boss.timer=y,L.checkpointDistance=2440,L.checkpointLane=L.lane,L.boss.lastDps=0,N("Boss!","#ffd3ec"))}if(function(e){for(let t=L.projectiles.length-1;t>=0;t--){const n=L.projectiles[t];if(n.y-=n.vy*e,n.y<-40){L.projectiles.splice(t,1);continue}let a=!1;for(let e=L.mobs.length-1;e>=0;e--){const t=L.mobs[e],i=n.x-t.x,l=n.y-t.y;if(i*i+l*l<=(n.r+18)*(n.r+18)){t.hp-=n.dmg,a=!0,t.hp<=0&&(L.mobs.splice(e,1),L.enemyScore+=90+8*L.snackLevel,L.purifiedCount+=1,L.mobsDefeated+=1,N("Sweet Hit!","#ffd27f"));break}}if(a)L.projectiles.splice(t,1);else if(L.boss.active){const e=n.x-210,a=n.y-178;e*e+a*a<=(n.r+74)*(n.r+74)&&(L.boss.hp=Math.max(0,L.boss.hp-.9*n.dmg),L.projectiles.splice(t,1))}}for(let t=L.mobs.length-1;t>=0;t--){const n=L.mobs[t];n.y+=n.speed*e,n.y>s-.5*I()&&(L.mobs.splice(t,1),L.party-=1,L.purify=Math.max(5,L.purify-2),L.hitFlash=.25,N("Mob Hit!","#ff9a9a"))}}(e),L.boss.lastDps=E()*T().length/R(),L.boss.active){if(L.boss.timer-=e,L.boss.hp<=0&&!L.boss.resolved)return L.boss.resolved=!0,void F(!0,"달달한 간식 투척으로 보스 정화 성공!");if(L.boss.timer<=0&&!L.boss.resolved)return L.boss.resolved=!0,void j("정화 시간이 부족했어요. 간식 레벨을 더 올려보세요.")}for(let t=L.popups.length-1;t>=0;t--){const n=L.popups[t];n.t+=e,n.y-=26*e,n.t>.9&&L.popups.splice(t,1)}V()}function H(e){const t=e.d-L.distance;if(t<-30||t>f)return;const n=84+560*(1-t/f),a=r[e.lane];let i=18;if("enemy"===e.kind&&(i=22),"thorn"===e.kind&&(i=16),x.save(),"jelly"===e.kind)x.fillStyle=v,x.beginPath(),x.ellipse(a,n,.8*i,i,0,0,2*Math.PI),x.fill();else if("seed"===e.kind)x.fillStyle=g,x.beginPath(),x.moveTo(a,n-i),x.lineTo(a+.9*i,n+.6*i),x.lineTo(a-.9*i,n+.6*i),x.closePath(),x.fill();else if("thorn"===e.kind){x.fillStyle=k;for(let e=0;e<3;e++)x.beginPath(),x.arc(a-.7*i+e*i*.7,n,.55*i,0,2*Math.PI),x.fill()}else"enemy"===e.kind&&(x.fillStyle=M,x.beginPath(),x.arc(a,n,.9*i,0,2*Math.PI),x.fill(),x.fillStyle="#fff",x.beginPath(),x.arc(a-.24*i,n-.12*i,.15*i,0,2*Math.PI),x.arc(a+.24*i,n-.12*i,.15*i,0,2*Math.PI),x.fill());x.restore()}function K(){!function(){x.save(),x.fillStyle="#eaf8ea",x.fillRect(0,0,l,o);const e=108,t=[{x:r[0]-54,color:"#dff5d9"},{x:r[1]-54,color:"#d3f1cb"},{x:r[2]-54,color:"#dff5d9"}];for(let n=0;n<t.length;n++)x.fillStyle=t[n].color,x.fillRect(t[n].x,0,e,o);x.strokeStyle="#b7ddbf",x.lineWidth=3,x.beginPath(),x.moveTo(.5*(r[0]+r[1]),0),x.lineTo(.5*(r[0]+r[1]),o),x.moveTo(.5*(r[1]+r[2]),0),x.lineTo(.5*(r[1]+r[2]),o),x.stroke();for(let e=0;e<10;e++){const t=(.35*L.distance+88*e)%o;x.fillStyle="#ffffff73",x.fillRect(28,t,364,6)}x.restore()}();for(let e=0;e<L.objects.length;e++){const t=L.objects[e];t.taken||H(t)}!function(){for(let e=0;e<L.mobs.length;e++){const t=L.mobs[e];x.save(),x.fillStyle="#7a6ae5",x.beginPath(),x.arc(t.x,t.y,20,0,2*Math.PI),x.fill(),x.fillStyle="#fff",x.beginPath(),x.arc(t.x-6,t.y-3,3.5,0,2*Math.PI),x.arc(t.x+6,t.y-3,3.5,0,2*Math.PI),x.fill();const n=Math.max(0,t.hp/t.maxHp);x.fillStyle="#ffffffcc",x.fillRect(t.x-18,t.y-30,36,5),x.fillStyle="#ff8ecb",x.fillRect(t.x-18,t.y-30,36*n,5),x.restore()}}(),function(){for(let e=0;e<L.projectiles.length;e++){const t=L.projectiles[e];x.save(),x.fillStyle="#ffd37c",x.beginPath(),x.arc(t.x,t.y,t.r,0,2*Math.PI),x.fill(),x.fillStyle="#fff3cc",x.beginPath(),x.arc(t.x-.3*t.r,t.y-.28*t.r,.38*t.r,0,2*Math.PI),x.fill(),x.restore()}}(),function(){const e=r[0]+(r[2]-r[0])*(L.laneVisual/2),t=s,n=Math.max(0,Math.floor(L.party)-1),a=Math.min(6,n),i=28;x.save(),L.hitFlash>0&&(x.globalAlpha=.55+.45*Math.sin(.04*L.elapsedMs));for(let n=0;n<a;n++){const a=33.6*(n%3-1),l=43.4+Math.floor(n/3)*(1.1*i),o=i*(1+.03*Math.sin(.006*L.elapsedMs+.8*n));x.fillStyle="#8fdf84",x.beginPath(),x.arc(e+a,t+l,o,0,2*Math.PI),x.fill(),x.fillStyle="#ffffff",x.beginPath(),x.arc(e+a-.33*o,t+l-.18*o,.15*o,0,2*Math.PI),x.arc(e+a+.33*o,t+l-.18*o,.15*o,0,2*Math.PI),x.fill()}n>a&&(x.fillStyle="#2c4a2f",x.font="700 13px Baloo 2, Nunito, sans-serif",x.textAlign="center",x.fillText("+"+(n-a),e,747.2)),x.fillStyle="#7adf72",x.beginPath(),x.arc(e,t,i,0,2*Math.PI),x.fill(),x.fillStyle="#fff",x.beginPath(),x.arc(e-8.4,632.4,.2*i,0,2*Math.PI),x.arc(e+8.4,632.4,.2*i,0,2*Math.PI),x.fill(),x.fillStyle="#2c4a2f",x.beginPath(),x.arc(e-8.4,632.4,2.24,0,2*Math.PI),x.arc(e+8.4,632.4,2.24,0,2*Math.PI),x.fill(),x.strokeStyle="#2c4a2f",x.lineWidth=3,x.beginPath(),x.arc(e,644.16,.28*i,.2,Math.PI-.2),x.stroke(),x.fillStyle="#93ec80",x.beginPath(),x.ellipse(e-6.72,607.2,6.72,.4*i,-.5,0,2*Math.PI),x.ellipse(e+6.72,607.2,6.72,.4*i,.5,0,2*Math.PI),x.fill(),x.restore()}(),function(){if(!L.boss.active)return;x.save();const e=210,t=178,n=r[0]+(r[2]-r[0])*(L.laneVisual/2),a=Math.max(0,Math.floor(L.party)-1),i=Math.min(6,a);x.strokeStyle="#8ae8ff88",x.lineWidth=2.5,x.beginPath(),x.moveTo(n,610),x.lineTo(e,206);for(let t=0;t<i;t++){const a=33.6*(t%3-1),i=43.4+Math.floor(t/3)*(28*1.1);x.moveTo(n+a,638+i-28*.2),x.lineTo(e+4*(t-3.5),208)}x.stroke(),x.fillStyle="#cfd4ff",x.beginPath(),x.arc(e,t,74,0,2*Math.PI),x.fill(),x.fillStyle="#fff",x.beginPath(),x.arc(190,168,10,0,2*Math.PI),x.arc(230,168,10,0,2*Math.PI),x.fill(),x.fillStyle="#5a5a8b",x.beginPath(),x.arc(190,168,3.4,0,2*Math.PI),x.arc(230,168,3.4,0,2*Math.PI),x.fill(),x.strokeStyle="#8490d1",x.lineWidth=4,x.beginPath(),x.arc(e,196,18,.2,Math.PI-.2),x.stroke();const l=244,o=Math.max(0,L.boss.hp/h),s=Math.max(0,L.boss.timer/y);x.fillStyle="#ffffffc5",x.fillRect(88,60,l,14),x.fillStyle="#ff95cd",x.fillRect(88,60,l*o,14),x.fillStyle="#ffffffc5",x.fillRect(88,80,l,10),x.fillStyle="#8bc1ff",x.fillRect(88,80,l*s,10),x.fillStyle="#27402f",x.font="700 14px Baloo 2, Nunito, sans-serif",x.textAlign="center",x.fillText("Boss (Sweet Weakness)",210,52),x.font="700 13px Baloo 2, Nunito, sans-serif",x.fillText(u[L.snackLevel-1].name+"  DPS "+Math.round(L.boss.lastDps)+"/s",210,106),x.restore()}(),function(){x.save(),x.textAlign="center",x.font="700 18px Baloo 2, Nunito, sans-serif";for(let e=0;e<L.popups.length;e++){const t=L.popups[e];x.globalAlpha=Math.max(0,1-t.t/.9),x.fillStyle=t.color,x.fillText(t.text,210,t.y-14*e)}x.restore()}(),x.save(),x.fillStyle="#ffffffd9",x.fillRect(8,8,332,96),x.fillStyle="#27402f",x.font="700 14px Baloo 2, Nunito, sans-serif",x.fillText("Snack Lv "+L.snackLevel+" - "+u[L.snackLevel-1].name,16,26),x.fillText("Dist "+Math.floor(L.distance)+" / "+c+"   Score "+C(0),16,46),x.fillText("Throwers "+Math.max(1,Math.floor(L.party))+"   Mobs Purified "+L.mobsDefeated,16,66),x.fillText("젤리: 레벨업, 씨앗: 투척자+, 가시: 약화",16,86),x.restore()}async function z(a){const i=L.db;if(!i||!L.uid)throw new Error("auth_not_ready");const l=function(e){return String(e||"").trim().toLowerCase().replace(/\s+/g," ").slice(0,20)}(a);if(l.length<2)throw new Error("nickname_too_short");if(l.length>20)throw new Error("nickname_too_long");const o=L.nickKeyLower;if(o===l)return L.nick=a,void localStorage.setItem(t,a);const s=i.collection("games").doc(e);await i.runTransaction(async function(e){const t=s.collection("nicknames").doc(l),i=await e.get(t);if(i.exists&&i.data().uid!==L.uid)throw new Error("nickname_taken");if(e.set(t,{uid:L.uid,nick:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),o&&o!==l){const t=s.collection("nicknames").doc(o),n=await e.get(t);n.exists&&n.data().uid===L.uid&&e.delete(t)}const r=s.collection("players").doc(L.uid);e.set(r,{uid:L.uid,nick:a,bestRankValue:Number(localStorage.getItem(n)||0),bestRawValue:Number(localStorage.getItem(n)||0),updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}),L.nick=a,L.nickKeyLower=l,localStorage.setItem(t,a)}async function G(t,n,a){if(!L.db||!L.uid||!Number.isFinite(t))return;a||L.latestSubmitted&&L.latestSubmitted.score;const i=L.db.collection("games").doc(e),l=i.collection("leaderboard").doc(L.uid),o=i.collection("players").doc(L.uid);await L.db.runTransaction(async function(e){const i=await e.get(l),s=i.exists?Number(i.data().rankValue):null;if(null!==s&&t<s&&!a)return;e.set(l,{uid:L.uid,nick:L.nick,rankValue:t,rawValue:t,durationMs:n,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0});const r=await e.get(o),c=r.exists?Number(r.data().bestRankValue||0):0;e.set(o,{uid:L.uid,nick:L.nick,bestRankValue:Math.max(c,t),bestRawValue:Math.max(c,t),updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})})}async function X(){if(!L.db)return S.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Offline</span><strong>-</strong></li>",void(S.myRank.textContent="My Rank: Offline");const t=L.db.collection("games").doc(e).collection("leaderboard"),n=await t.orderBy("rankValue","desc").limit(10).get(),a=[];if(n.forEach(function(e,t){const n=e.data()||{},i=t+1,l=1===i?"rank-1":2===i?"rank-2":3===i?"rank-3":"",o=n.nick||"Anon",s=Number(n.rankValue||0);a.push("<li class='lb-item'><span class='"+l+"'>"+i+"</span><span>"+(String(o||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")+"</span><strong>")+s+"</strong></li>")}),0===a.length&&a.push("<li class='lb-item'><span>-</span><span>No entries yet</span><strong>0</strong></li>"),S.lbList.innerHTML=a.join(""),!L.uid)return void(S.myRank.textContent="My Rank: Sign-in pending");const i=await t.doc(L.uid).get();if(!i.exists)return void(S.myRank.textContent="My Rank: Unranked");const l=Number((i.data()||{}).rankValue||0),o=(await t.where("rankValue",">",l).get()).size+1;S.myRank.textContent="My Rank: #"+o+" | "+L.nick+" | "+l}function q(){L.modalOpen=!1,S.leaderboardModal.classList.remove("show")}function J(e){try{const t="string"==typeof e?JSON.parse(e):e;if(!t||!t.type)return;"REWARDED_GRANTED"===t.type?L.awaitingRevive&&(L.reviveUsed=!0,L.awaitingRevive=!1,L.modalOpen=!1,L.running=!0,L.distance=L.checkpointDistance,L.lane=L.checkpointLane,L.party=Math.max(2,L.party+2),L.purify+=8,L.hitFlash=0,N("Revived!","#fff09c"),S.reviveOverlay.classList.remove("show")):"REWARDED_DENIED"===t.type&&L.awaitingRevive&&F(!1,"Revive was not granted.")}catch(e){}}!function(){function e(e){if(L.modalOpen)return;const t=e.touches&&e.touches[0]?e.touches[0].clientX:e.clientX;null!=t&&D(function(e){const t=S.arena.getBoundingClientRect(),n=(e-t.left)/t.width;return n<.333?0:n>.666?2:1}(t))}S.arena.addEventListener("pointerdown",e,{passive:!0}),S.arena.addEventListener("pointermove",function(t){1===t.buttons&&e(t)},{passive:!0}),S.arena.addEventListener("touchstart",e,{passive:!0}),S.arena.addEventListener("touchmove",e,{passive:!0}),S.leftBtn.addEventListener("pointerdown",function(){D(L.lane-1)}),S.rightBtn.addEventListener("pointerdown",function(){D(L.lane+1)}),S.centerBtn.addEventListener("pointerdown",function(){D(1)}),window.addEventListener("keydown",function(e){"ArrowLeft"!==e.key&&"a"!==e.key||D(L.lane-1),"ArrowRight"!==e.key&&"d"!==e.key||D(L.lane+1),"ArrowDown"!==e.key&&"s"!==e.key||D(1)})}(),S.restartBtn.addEventListener("click",O),S.playAgainBtn.addEventListener("click",O),S.topBtn.addEventListener("click",function(){!async function(){L.modalOpen=!0,S.leaderboardModal.classList.add("show"),L.latestSubmitted&&(S.latestRun.style.display="block"),await X()}()}),S.closeLbBtn.addEventListener("click",q),S.reviveBtn.addEventListener("click",function(){w("REQUEST_REWARDED",{reason:"revive"})}),S.skipReviveBtn.addEventListener("click",function(){F(!1,"Skipped revive.")}),S.changeNickBtn.addEventListener("click",function(){S.nickInput.disabled=!1,S.saveNickBtn.style.display="inline-block",S.changeNickBtn.style.display="none",S.nickInput.focus()}),S.saveNickBtn.addEventListener("click",async function(){const e=(S.nickInput.value||"").trim();if(e.length<2)alert("Nickname must be at least 2 characters.");else try{await z(e),S.nickInput.disabled=!0,S.saveNickBtn.style.display="none",S.changeNickBtn.style.display="inline-block",await X()}catch(e){"nickname_taken"===String(e&&e.message)?alert("Nickname is already taken."):alert("Failed to save nickname.")}}),window.addEventListener("message",function(e){J(e.data)}),document.addEventListener("message",function(e){J(e.data)}),function(){try{const a={apiKey:"<api-key>",authDomain:"<project-id>.firebaseapp.com",projectId:"<project-id>",appId:"<app-id>"};if(!a.projectId||a.projectId.indexOf("<")>=0)throw new Error("firebase_placeholder");firebase.initializeApp(a),L.db=firebase.firestore();return firebase.auth().signInAnonymously().then(function(t){return L.uid=t.user.uid,L.db?L.db.collection("games").doc(e).set({gameId:e,name:"Sprout Lane Guardians",sortDirection:"desc",rankType:"score",updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}):Promise.resolve()}).then(async function(){const e=(localStorage.getItem(t)||"").trim()||B();try{await z(e)}catch(e){const t=B();await z(t)}S.nickInput.value=L.nick,await X();const a=Number(localStorage.getItem(n)||0);a>0&&await G(a,0,!0)}).catch(function(){L.db=null})}catch(e){return L.db=null,Promise.resolve()}}(),O(),requestAnimationFrame(function e(t){L.lastFrame||(L.lastFrame=t);const n=Math.min(.034,(t-L.lastFrame)/1e3);L.lastFrame=t,U(n),K(),requestAnimationFrame(e)})}()</script></body></html>