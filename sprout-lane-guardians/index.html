<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="game-id" content="sprout-lane-guardians"><meta name="game-version" content="0.1.0"><title>Sprout Lane Guardians</title><style>:root{--ink:#27402f;--panel:#fffef8;--line:#b8dcc4;--mint:#a8f0cf;--sky:#a5deff;--pink:#ff96c6;--sun:#ffe38a;--danger:#ff8b8b;--gold:#cb9f28;--silver:#8897a6;--bronze:#9d6c48}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body,html{overscroll-behavior:none}body{margin:0;min-height:100vh;color:var(--ink);background:radial-gradient(circle at 15% 10%,#fffadf 0,transparent 34%),radial-gradient(circle at 84% 18%,#ffeaf6 0,transparent 32%),linear-gradient(180deg,#c9f4ff 0,#f1ffe8 55%,#f7f5df 100%);font-family:"Baloo 2",Nunito,"Trebuchet MS",sans-serif;display:flex;justify-content:center;overflow:hidden;touch-action:none;user-select:none}.app{width:min(100vw,540px);padding:10px;padding-top:calc(14px + env(safe-area-inset-top));padding-bottom:calc(14px + env(safe-area-inset-bottom))}.topbar{display:grid;grid-template-columns:1fr 1fr 1fr 1fr auto auto;gap:8px;margin-bottom:8px}.pill{border:2px solid var(--line);border-radius:12px;background:#ffffffdb;text-align:center;font-size:13px;font-weight:800;padding:8px 4px}button{border:none;border-radius:12px;padding:10px 10px;font-weight:800;font-size:14px;background:#57bf93;color:#fff;cursor:pointer}#arenaWrap{position:relative;border:3px solid #8ec8a8;border-radius:16px;overflow:hidden;background:linear-gradient(180deg,#99d9ff 0,#f7ffe9 100%);box-shadow:inset 0 -30px 110px rgba(49,80,52,.22);touch-action:none}canvas{width:100%;height:auto;display:block;touch-action:none}.hint{min-height:18px;text-align:center;margin-top:6px;font-size:13px;font-weight:700;opacity:.95}.tutorial-banner{margin-top:6px;min-height:34px;border:2px solid #bde7cb;border-radius:12px;background:#f7fff3;display:none;align-items:center;justify-content:center;text-align:center;padding:6px 10px;font-size:13px;font-weight:800;color:#256047}.tutorial-banner.show{display:flex}.controls{margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px}.pad{display:grid;grid-template-columns:1fr 1fr;gap:8px}.btn-big{min-height:56px;font-size:19px;border:2px solid #3f8d6d;background:#66ca9f}.btn-center{min-height:56px;font-size:17px;border:2px solid #3f8d6d;background:#4fb98d}.modal,.overlay{position:fixed;inset:0;background:rgba(24,41,29,.52);display:none;align-items:center;justify-content:center;padding:14px;z-index:12}.modal.show,.overlay.show{display:flex}.panel{width:min(100%,470px);background:var(--panel);border-radius:14px;border:2px solid #cee7d6;padding:14px}.panel h2{margin:0 0 8px;font-size:22px}.row{display:flex;align-items:center;gap:8px}.row-end{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}input[type=text]{flex:1;border:2px solid #d4ebdd;border-radius:10px;padding:8px;font-size:14px;min-width:0}.lb-list{list-style:none;margin:10px 0;padding:0;border:1px solid #e4f0e8;border-radius:10px;max-height:280px;overflow:auto;background:#fdfffd}.lb-item{display:grid;grid-template-columns:34px 1fr auto;gap:8px;padding:7px 10px;border-bottom:1px solid #edf7f0;font-size:14px}.lb-item:last-child{border-bottom:none}.rank-1{color:var(--gold);font-weight:800}.rank-2{color:var(--silver);font-weight:800}.rank-3{color:var(--bronze);font-weight:800}.my-rank{font-size:14px;background:#f4ffec;border:2px solid #c8efb6;border-radius:10px;padding:8px 10px}@media (max-width:420px){.topbar{grid-template-columns:1fr 1fr 1fr auto auto}.pill.small-hide{display:none}}</style></head><body><div class="app"><div class="topbar"><div class="pill">Snack <span id="zoneLabel">1</span>/10</div><div class="pill">Party <span id="party">3</span></div><div class="pill">Purify <span id="purify">12</span></div><div class="pill small-hide">Power <span id="power">36</span></div><button id="topBtn">Top</button> <button id="restartBtn">Restart</button></div><div id="arenaWrap"><canvas id="arena" width="420" height="760" aria-label="game field"></canvas></div><div id="hint" class="hint">Drag/tap lane to dodge and collect. Purify cute troublemakers.</div><div id="tutorialBanner" class="tutorial-banner"></div><div class="controls"><div class="pad"><button id="leftBtn" class="btn-big">◀</button> <button id="rightBtn" class="btn-big">▶</button></div><button id="centerBtn" class="btn-center">CENTER</button></div></div><div id="reviveOverlay" class="overlay"><div class="panel"><h2>Revive once?</h2><p id="reviveText">Use rewarded ad in wrapper to continue from checkpoint.</p><div class="row"><button id="reviveBtn">Revive</button> <button id="skipReviveBtn" style="background:#ca6666">No Thanks</button></div></div></div><div id="gameOverOverlay" class="overlay"><div class="panel"><h2 id="resultTitle">Run Ended</h2><p>Score: <strong id="finalScore">0</strong></p><p>Duration: <strong id="finalTime">0.00s</strong></p><p id="resultDetail">Keep collecting growth items before boss.</p><div class="row"><button id="playAgainBtn">Play Again</button></div></div></div><div id="leaderboardModal" class="modal"><div class="panel"><h2>Global Top 10</h2><div id="latestRun" class="my-rank" style="display:none;margin-bottom:8px"></div><div class="row"><input id="nickInput" maxlength="20" disabled="disabled"> <button id="changeNickBtn">Change</button> <button id="saveNickBtn" style="display:none">Save</button></div><ul id="lbList" class="lb-list"></ul><div id="myRank" class="my-rank">My Rank: -</div><div class="row-end"><button id="closeLbBtn">Close</button></div></div></div><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script><script>!function(){"use strict";const e="sprout-lane-guardians",t=e+":nick",n=e+":best",a=e+":interstitial:last",i=e+":tutorialSeen",l=420,o=760,r=638,s=[106,210,314],c=2460,f=940,d=[0,820,1640,c],u=[{name:"솜젤리",dmg:12},{name:"딸기쿠키",dmg:16},{name:"허니마카롱",dmg:21},{name:"카라멜롤",dmg:27},{name:"초코번",dmg:34},{name:"민트파이",dmg:42},{name:"레인보우캔디",dmg:51},{name:"크림도넛",dmg:61},{name:"슈가타르트",dmg:72},{name:"별사탕코어",dmg:84}],m=[{d:560,left:{label:"+2 THROWERS",effect:function(){I.party+=2,C("Throwers +2","#66ca9f")}},right:{label:"SNACK LV +1",effect:function(){I.snackLevel=Math.min(10,I.snackLevel+1),C("Snack Lv Up!","#7cbcff")}}},{d:1180,left:{label:"+3 THROWERS",effect:function(){I.party+=3,C("Throwers +3","#66ca9f")}},right:{label:"SNACK LV +1",effect:function(){I.snackLevel=Math.min(10,I.snackLevel+1),C("Snack Lv Up!","#7cbcff")}}},{d:1760,left:{label:"+4 THROWERS",effect:function(){I.party+=4,C("Throwers +4","#66ca9f")}},right:{label:"SNACK LV +2",effect:function(){I.snackLevel=Math.min(10,I.snackLevel+2),C("Snack Lv Big Up!","#7cbcff")}}}],p=900,h=1700,y=8,g="#ff7fb5",v="#ffe27a",b="#78a15d",k="#ff8b8b",S="#7a6ae5",x={arena:document.getElementById("arena"),zoneLabel:document.getElementById("zoneLabel"),party:document.getElementById("party"),purify:document.getElementById("purify"),power:document.getElementById("power"),hint:document.getElementById("hint"),tutorialBanner:document.getElementById("tutorialBanner"),topBtn:document.getElementById("topBtn"),restartBtn:document.getElementById("restartBtn"),leftBtn:document.getElementById("leftBtn"),rightBtn:document.getElementById("rightBtn"),centerBtn:document.getElementById("centerBtn"),reviveOverlay:document.getElementById("reviveOverlay"),reviveText:document.getElementById("reviveText"),reviveBtn:document.getElementById("reviveBtn"),skipReviveBtn:document.getElementById("skipReviveBtn"),gameOverOverlay:document.getElementById("gameOverOverlay"),resultTitle:document.getElementById("resultTitle"),resultDetail:document.getElementById("resultDetail"),finalScore:document.getElementById("finalScore"),finalTime:document.getElementById("finalTime"),playAgainBtn:document.getElementById("playAgainBtn"),leaderboardModal:document.getElementById("leaderboardModal"),lbList:document.getElementById("lbList"),myRank:document.getElementById("myRank"),latestRun:document.getElementById("latestRun"),nickInput:document.getElementById("nickInput"),changeNickBtn:document.getElementById("changeNickBtn"),saveNickBtn:document.getElementById("saveNickBtn"),closeLbBtn:document.getElementById("closeLbBtn")},M=x.arena.getContext("2d"),I={running:!1,modalOpen:!1,awaitingRevive:!1,reviveUsed:!1,elapsedMs:0,score:0,best:Number(localStorage.getItem(n)||0),distance:0,checkpointDistance:0,lane:1,laneVisual:1,checkpointLane:1,party:1,purify:12,snackLevel:1,snackExp:0,fireTimer:0,mobTimer:0,projectiles:[],mobs:[],mobsDefeated:0,hitFlash:0,startedSent:!1,tutorial:{active:!1,elapsed:0,step:0},objects:[],gates:[],popups:[],purifiedCount:0,itemScore:0,enemyScore:0,boss:{active:!1,hp:h,timer:0,resolved:!1,lastDps:0},lastFrame:0,db:null,uid:null,nick:"",nickKeyLower:"",latestSubmitted:null};function L(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ",t="23456789";return"Sprout"+e[Math.floor(24*Math.random())]+t[Math.floor(8*Math.random())]+t[Math.floor(8*Math.random())]}function B(e,t){const n=JSON.stringify({type:e,payload:t||{}});window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage&&window.ReactNativeWebView.postMessage(n)}function w(){return 12}function T(){return u[I.snackLevel-1].dmg}function E(){return Math.max(.12,.42-.02*(I.snackLevel-1))}function P(){const e=Math.max(0,Math.floor(I.party)-1),t=Math.min(18,e),n=[{x:0,y:.95*-12}];for(let e=0;e<t;e++){const t=17.4*(e%6-2.5),a=20.4+15*Math.floor(e/6);n.push({x:t,y:a-10.8})}return n}function R(e){return e<d[1]?1:e<d[2]?2:3}function C(e,t){I.popups.push({text:e,color:t||"#ffffff",t:0,y:592}),I.popups.length>6&&I.popups.shift()}function N(e){return Math.floor(.72*I.distance)+I.itemScore+I.enemyScore+40*I.purifiedCount+Math.floor(65*I.party)+Math.floor(12*I.purify)+(e||0)}function D(e){I.lane=Math.max(0,Math.min(2,e))}function A(){if(!I.tutorial.active)return x.tutorialBanner.classList.remove("show"),void(x.tutorialBanner.textContent="");x.tutorialBanner.classList.add("show"),0===I.tutorial.step?x.tutorialBanner.textContent="Tutorial 1/3: 좌우로 이동해서 젤리를 먹어보세요":1===I.tutorial.step?x.tutorialBanner.textContent="Tutorial 2/3: 씨앗을 먹어 동료 수를 늘리세요":x.tutorialBanner.textContent="Tutorial 3/3: 자동 투척 전투로 몹을 정화하세요"}function O(){I.running=!0,I.modalOpen=!1,I.awaitingRevive=!1,I.reviveUsed=!1,I.elapsedMs=0,I.score=0,I.distance=0,I.checkpointDistance=0,I.lane=1,I.laneVisual=1,I.checkpointLane=1,I.party=1,I.purify=12,I.snackLevel=1,I.snackExp=0,I.fireTimer=0,I.mobTimer=0,I.projectiles=[],I.mobs=[],I.mobsDefeated=0,I.hitFlash=0,I.purifiedCount=0,I.itemScore=0,I.enemyScore=0,I.startedSent=!1,I.tutorial.active="1"!==localStorage.getItem(i),I.tutorial.elapsed=0,I.tutorial.step=0,I.objects=function(){const e=function(){let e=20260222%2147483647;return e<=0&&(e+=2147483646),function(){return e=16807*e%2147483647,(e-1)/2147483646}}(),t=[];for(let n=180;n<2180;n+=65+Math.floor(46*e())){if(m.some(function(e){return Math.abs(e.d-n)<90}))continue;const a=Math.floor(3*e()),i=e();i<.52?t.push({kind:"jelly",lane:a,d:n,taken:!1}):i<.74?t.push({kind:"seed",lane:a,d:n,taken:!1}):t.push({kind:"thorn",lane:a,d:n,taken:!1})}for(let e=0;e<8;e++){const n=230+260*e;t.push({kind:"jelly",lane:e%3,d:n,taken:!1}),t.push({kind:"jelly",lane:(e+1)%3,d:n+26,taken:!1})}if(I.tutorial.active){t.push({kind:"jelly",lane:0,d:170,taken:!1}),t.push({kind:"jelly",lane:1,d:210,taken:!1}),t.push({kind:"seed",lane:2,d:290,taken:!1}),t.push({kind:"seed",lane:1,d:340,taken:!1});for(let e=0;e<t.length;e++)t[e].d<560&&"thorn"===t[e].kind&&(t[e].kind=e%2==0?"jelly":"seed")}return t.sort(function(e,t){return e.d-t.d}),t}(),I.gates=m.map(function(e){return{d:e.d,left:e.left,right:e.right,applied:!1}}),I.popups=[],I.boss.active=!1,I.boss.hp=h,I.boss.timer=0,I.boss.resolved=!1,I.boss.lastDps=0,I.lastFrame=0,x.reviveOverlay.classList.remove("show"),x.gameOverOverlay.classList.remove("show"),x.latestRun.style.display="none",x.hint.textContent="젤리로 간식 업그레이드, 씨앗으로 투척 동료 추가",A(),V(),B("GAME_START",{}),I.startedSent=!0}function V(){const e=Math.round(Math.max(1,I.party*(4+2*I.snackLevel)+I.purify)),t=p;x.zoneLabel.textContent=String(I.snackLevel),x.party.textContent=String(Math.max(0,Math.floor(I.party))),x.purify.textContent=String(Math.round(I.purify)),x.power.textContent=String(e),I.tutorial.active?x.hint.textContent="작은 리더 1명으로 시작합니다. 씨앗으로 동료를 늘리세요":I.boss.active?x.hint.textContent="보스전: "+u[I.snackLevel-1].name+" 투척 중! (파워 "+e+" / 권장 "+t+")":x.hint.textContent=e<.55*t?"간식 Lv "+I.snackLevel+" ("+u[I.snackLevel-1].name+"), 젤리/씨앗으로 성장하세요":"좋아요! 몹을 간식으로 약화시키며 보스로 이동하세요"}function j(e){I.reviveUsed?F(!1,e||"Failed to stabilize the forest."):(I.running=!1,I.awaitingRevive=!0,I.modalOpen=!0,x.reviveText.textContent="Revive from checkpoint and recover your sprout team.",x.reviveOverlay.classList.add("show"))}function F(e,t){I.running=!1,I.awaitingRevive=!1,I.modalOpen=!1,x.reviveOverlay.classList.remove("show"),x.gameOverOverlay.classList.add("show");const i=Math.max(1,Math.round(I.elapsedMs)),l=N(e?1400:0);e?(x.resultTitle.textContent="Forest Restored",x.resultDetail.textContent=t||"Boss purified. Sparkles everywhere."):(x.resultTitle.textContent="Run Ended",x.resultDetail.textContent=t||"Collect better gates and avoid thorn hits."),I.score=l,I.latestSubmitted={score:l,durationMs:i},x.finalScore.textContent=String(l),x.finalTime.textContent=(i/1e3).toFixed(2)+"s",x.latestRun.style.display="block",x.latestRun.textContent="Latest run: "+l+" points in "+(i/1e3).toFixed(2)+"s",l>I.best&&(I.best=l,localStorage.setItem(n,String(l))),B("GAME_OVER",{score:l,durationMs:i}),function(){try{const e=Date.now(),t=Number(localStorage.getItem(a)||0);return!(t&&e-t<35e3||(localStorage.setItem(a,String(e)),0))}catch(e){return!1}}()&&B("REQUEST_INTERSTITIAL",{reason:"run_completed"}),z(l,i,!1)}function W(e){e[I.lane<=1?"left":"right"].effect(),e.applied=!0,I.checkpointDistance=e.d+20,I.checkpointLane=I.lane}function _(e){if(e.taken=!0,"jelly"===e.kind){I.snackExp+=1;const e=2*I.snackLevel;return I.snackLevel<10&&I.snackExp>=e&&(I.snackExp=0,I.snackLevel+=1,C("Snack Lv "+I.snackLevel+"!","#9dd4ff")),I.itemScore+=55,void C("Snack EXP +1",g)}if("seed"===e.kind){const e=1;return I.party+=e,I.itemScore+=90,void C("Party +"+e,v)}if("thorn"===e.kind)return I.party-=1,I.purify=Math.max(5,I.purify-3),I.hitFlash=.25,void C("Ouch",k)}function U(e){if(!I.running||I.modalOpen)return;I.elapsedMs+=1e3*e,I.tutorial.active&&(I.tutorial.elapsed+=e,I.tutorial.elapsed<2.5?I.tutorial.step=0:I.tutorial.elapsed<5?I.tutorial.step=1:I.tutorial.step=2,A(),I.tutorial.elapsed>=8&&(I.tutorial.active=!1,localStorage.setItem(i,"1"),A())),I.hitFlash>0&&(I.hitFlash=Math.max(0,I.hitFlash-e)),I.laneVisual+=(I.lane-I.laneVisual)*Math.min(1,14*e),I.fireTimer+=e,I.fireTimer>=E()&&(I.fireTimer=0,function(){const e=s[0]+(s[2]-s[0])*(I.laneVisual/2),t=P(),n=I.snackLevel;for(let a=0;a<t.length;a++)I.projectiles.push({x:e+t[a].x,y:638+t[a].y,vy:410+20*n+3*a,dmg:T(),tier:n,r:5+.6*n})}()),I.mobTimer+=e;const t=I.boss.active?.72:Math.max(.42,.95-.04*I.snackLevel);if(I.mobTimer>=t&&(I.mobTimer=0,function(){const e=Math.floor(3*Math.random()),t=30+8*I.snackLevel+9*R(I.distance);I.mobs.push({lane:e,x:s[e],y:-30,hp:t,maxHp:t,speed:68+45*Math.random()+7*R(I.distance)})}()),!I.boss.active){const t=196+14*R(I.distance);I.distance+=t*e;for(let e=0;e<I.gates.length;e++){const t=I.gates[e];!t.applied&&I.distance>=t.d-6&&W(t)}for(let e=0;e<I.objects.length;e++){const t=I.objects[e];t.taken||(Math.abs(t.d-I.distance)>20||Math.abs(t.lane-I.laneVisual)>.45||_(t))}if(I.party<=0)return void j("Your sprout party ran out.");I.distance>=c&&(I.boss.active=!0,I.boss.hp=h,I.boss.timer=y,I.checkpointDistance=2440,I.checkpointLane=I.lane,I.boss.lastDps=0,C("Boss!","#ffd3ec"))}if(function(e){for(let t=I.projectiles.length-1;t>=0;t--){const n=I.projectiles[t];if(n.y-=n.vy*e,n.y<-40){I.projectiles.splice(t,1);continue}let a=!1;for(let e=I.mobs.length-1;e>=0;e--){const t=I.mobs[e],i=n.x-t.x,l=n.y-t.y;if(i*i+l*l<=(n.r+18)*(n.r+18)){t.hp-=n.dmg,a=!0,t.hp<=0&&(I.mobs.splice(e,1),I.enemyScore+=90+8*I.snackLevel,I.purifiedCount+=1,I.mobsDefeated+=1,C("Sweet Hit!","#ffd27f"));break}}if(a)I.projectiles.splice(t,1);else if(I.boss.active){const e=n.x-210,a=n.y-178;e*e+a*a<=(n.r+74)*(n.r+74)&&(I.boss.hp=Math.max(0,I.boss.hp-.9*n.dmg),I.projectiles.splice(t,1))}}for(let t=I.mobs.length-1;t>=0;t--){const n=I.mobs[t];n.y+=n.speed*e,n.y>r-.5*w()&&(I.mobs.splice(t,1),I.party-=1,I.purify=Math.max(5,I.purify-2),I.hitFlash=.25,C("Mob Hit!","#ff9a9a"))}}(e),I.boss.lastDps=T()*P().length/E(),I.boss.active){if(I.boss.timer-=e,I.boss.hp<=0&&!I.boss.resolved)return I.boss.resolved=!0,void F(!0,"달달한 간식 투척으로 보스 정화 성공!");if(I.boss.timer<=0&&!I.boss.resolved)return I.boss.resolved=!0,void j("정화 시간이 부족했어요. 간식 레벨을 더 올려보세요.")}for(let t=I.popups.length-1;t>=0;t--){const n=I.popups[t];n.t+=e,n.y-=26*e,n.t>.9&&I.popups.splice(t,1)}V()}function H(e){const t=e.d-I.distance;if(t<-30||t>f)return;const n=84+560*(1-t/f),a=s[e.lane];let i=18;if("enemy"===e.kind&&(i=22),"thorn"===e.kind&&(i=16),M.save(),"jelly"===e.kind)M.fillStyle=g,M.beginPath(),M.ellipse(a,n,.8*i,i,0,0,2*Math.PI),M.fill();else if("seed"===e.kind)M.fillStyle=v,M.beginPath(),M.moveTo(a,n-i),M.lineTo(a+.9*i,n+.6*i),M.lineTo(a-.9*i,n+.6*i),M.closePath(),M.fill();else if("thorn"===e.kind){M.fillStyle=b;for(let e=0;e<3;e++)M.beginPath(),M.arc(a-.7*i+e*i*.7,n,.55*i,0,2*Math.PI),M.fill()}else"enemy"===e.kind&&(M.fillStyle=S,M.beginPath(),M.arc(a,n,.9*i,0,2*Math.PI),M.fill(),M.fillStyle="#fff",M.beginPath(),M.arc(a-.24*i,n-.12*i,.15*i,0,2*Math.PI),M.arc(a+.24*i,n-.12*i,.15*i,0,2*Math.PI),M.fill());M.restore()}function G(){!function(){M.save(),M.fillStyle="#eaf8ea",M.fillRect(0,0,l,o);const e=108,t=[{x:s[0]-54,color:"#dff5d9"},{x:s[1]-54,color:"#d3f1cb"},{x:s[2]-54,color:"#dff5d9"}];for(let n=0;n<t.length;n++)M.fillStyle=t[n].color,M.fillRect(t[n].x,0,e,o);M.strokeStyle="#b7ddbf",M.lineWidth=3,M.beginPath(),M.moveTo(.5*(s[0]+s[1]),0),M.lineTo(.5*(s[0]+s[1]),o),M.moveTo(.5*(s[1]+s[2]),0),M.lineTo(.5*(s[1]+s[2]),o),M.stroke();for(let e=0;e<10;e++){const t=(.35*I.distance+88*e)%o;M.fillStyle="#ffffff73",M.fillRect(28,t,364,6)}M.restore()}();for(let e=0;e<I.objects.length;e++){const t=I.objects[e];t.taken||H(t)}!function(){for(let e=0;e<I.mobs.length;e++){const t=I.mobs[e];M.save(),M.fillStyle="#7a6ae5",M.beginPath(),M.arc(t.x,t.y,20,0,2*Math.PI),M.fill(),M.fillStyle="#fff",M.beginPath(),M.arc(t.x-6,t.y-3,3.5,0,2*Math.PI),M.arc(t.x+6,t.y-3,3.5,0,2*Math.PI),M.fill();const n=Math.max(0,t.hp/t.maxHp);M.fillStyle="#ffffffcc",M.fillRect(t.x-18,t.y-30,36,5),M.fillStyle="#ff8ecb",M.fillRect(t.x-18,t.y-30,36*n,5),M.restore()}}(),function(){for(let e=0;e<I.projectiles.length;e++){const t=I.projectiles[e],n=t.tier;if(M.save(),1===n)M.fillStyle="#ffe49e",M.beginPath(),M.arc(t.x,t.y,.9*t.r,0,2*Math.PI),M.fill();else if(2===n)M.fillStyle="#ff9db6",M.fillRect(t.x-.9*t.r,t.y-.7*t.r,1.8*t.r,1.4*t.r);else if(3===n)M.fillStyle="#f8c786",M.beginPath(),M.moveTo(t.x,t.y-t.r),M.lineTo(t.x+t.r,t.y+t.r),M.lineTo(t.x-t.r,t.y+t.r),M.closePath(),M.fill();else if(4===n)M.fillStyle="#b67a4d",M.beginPath(),M.arc(t.x,t.y,t.r,0,2*Math.PI),M.fill(),M.fillStyle="#6e4a2a",M.fillRect(t.x-.3*t.r,t.y-.7*t.r,.6*t.r,1.4*t.r);else if(5===n)M.fillStyle="#f2aa66",M.beginPath(),M.ellipse(t.x,t.y,1.25*t.r,.75*t.r,0,0,2*Math.PI),M.fill();else if(6===n)M.fillStyle="#8cdcc6",M.beginPath(),M.moveTo(t.x,t.y-t.r),M.lineTo(t.x+.9*t.r,t.y),M.lineTo(t.x,t.y+t.r),M.lineTo(t.x-.9*t.r,t.y),M.closePath(),M.fill();else if(7===n){M.fillStyle="#9bc7ff",M.beginPath();for(let e=0;e<5;e++){const n=-Math.PI/2+e*(2*Math.PI/5),a=e%2==0?1.1*t.r:.45*t.r,i=t.x+Math.cos(n)*a,l=t.y+Math.sin(n)*a;0===e?M.moveTo(i,l):M.lineTo(i,l)}M.closePath(),M.fill()}else if(8===n)M.fillStyle="#ffe7ae",M.beginPath(),M.arc(t.x,t.y,t.r,0,2*Math.PI),M.fill(),M.fillStyle="#ffa0b6",M.beginPath(),M.arc(t.x,t.y,.35*t.r,0,2*Math.PI),M.fill();else if(9===n)M.fillStyle="#ffd4ff",M.beginPath(),M.moveTo(t.x,t.y-1.2*t.r),M.lineTo(t.x+.9*t.r,t.y),M.lineTo(t.x,t.y+1.2*t.r),M.lineTo(t.x-.9*t.r,t.y),M.closePath(),M.fill(),M.fillStyle="#ffffffa8",M.fillRect(t.x-.15*t.r,t.y-.8*t.r,.3*t.r,1.6*t.r);else{const e=M.createRadialGradient(t.x,t.y,.8,t.x,t.y,1.4*t.r);e.addColorStop(0,"#ffffff"),e.addColorStop(.5,"#ffec9c"),e.addColorStop(1,"#ff8cc9"),M.fillStyle=e,M.beginPath(),M.arc(t.x,t.y,1.15*t.r,0,2*Math.PI),M.fill(),M.strokeStyle="#fff8d7",M.lineWidth=1.2,M.beginPath(),M.moveTo(t.x-1.4*t.r,t.y),M.lineTo(t.x+1.4*t.r,t.y),M.moveTo(t.x,t.y-1.4*t.r),M.lineTo(t.x,t.y+1.4*t.r),M.stroke()}M.fillStyle="#ffffff88",M.beginPath(),M.arc(t.x-.25*t.r,t.y-.25*t.r,.25*t.r,0,2*Math.PI),M.fill(),M.restore()}}(),function(){const e=s[0]+(s[2]-s[0])*(I.laneVisual/2),t=r,n=Math.max(0,Math.floor(I.party)-1),a=Math.min(50,n),i=12;M.save(),I.hitFlash>0&&(M.globalAlpha=.55+.45*Math.sin(.04*I.elapsedMs));for(let n=0;n<a;n++){const a=10,i=8*(n%a-.5*(a-1)),l=22+8*Math.floor(n/a),o=3.2*(1+.05*Math.sin(.006*I.elapsedMs+.5*n)),r=M.createRadialGradient(e+i-1,t+l-1.2,.6,e+i,t+l,1.25*o);r.addColorStop(0,"#d8ffcf"),r.addColorStop(1,"#63c86e"),M.fillStyle=r,M.beginPath(),M.arc(e+i,t+l,o,0,2*Math.PI),M.fill(),M.fillStyle="#ffffffd0",M.beginPath(),M.arc(e+i-.24*o,t+l-.14*o,.12*o,0,2*Math.PI),M.arc(e+i+.24*o,t+l-.14*o,.12*o,0,2*Math.PI),M.fill()}n>a&&(M.fillStyle="#2c4a2f",M.font="700 13px Baloo 2, Nunito, sans-serif",M.textAlign="center",M.fillText("+"+(n-a),e,708));const l=M.createRadialGradient(e-.35*i,633.2,3,e,t,1.2*i);l.addColorStop(0,"#f6ffd8"),l.addColorStop(.56,"#8fe77f"),l.addColorStop(1,"#58b65c"),M.fillStyle=l,M.beginPath(),M.arc(e,t,i,0,2*Math.PI),M.fill(),M.fillStyle="#fff",M.beginPath(),M.arc(e-.3*i,635.6,.2*i,0,2*Math.PI),M.arc(e+.3*i,635.6,.2*i,0,2*Math.PI),M.fill(),M.fillStyle="#2c4a2f",M.beginPath(),M.arc(e-.3*i,635.6,.96,0,2*Math.PI),M.arc(e+.3*i,635.6,.96,0,2*Math.PI),M.fill(),M.strokeStyle="#2c4a2f",M.lineWidth=3,M.beginPath(),M.arc(e,640.64,.28*i,.2,Math.PI-.2),M.stroke(),M.fillStyle="#93ec80",M.beginPath(),M.ellipse(e-2.88,624.8,2.88,.4*i,-.5,0,2*Math.PI),M.ellipse(e+2.88,624.8,2.88,.4*i,.5,0,2*Math.PI),M.fill(),M.fillStyle="#00000024",M.beginPath(),M.ellipse(e,652.16,10.8,3.12,0,0,2*Math.PI),M.fill(),M.restore()}(),function(){if(!I.boss.active)return;M.save();const e=210,t=176,n=s[0]+(s[2]-s[0])*(I.laneVisual/2),a=Math.max(0,Math.floor(I.party)-1),i=Math.min(18,a);M.strokeStyle="#8ae8ff88",M.lineWidth=2.5,M.beginPath(),M.moveTo(n,626),M.lineTo(e,204);for(let t=0;t<i;t++){const a=17.4*(t%6-2.5),i=20.4+15*Math.floor(t/6);M.moveTo(n+a,638+i-12*.2),M.lineTo(e+4*(t-3.5),206)}M.stroke();const l=M.createLinearGradient(e,96,e,266);l.addColorStop(0,"#fff5d1"),l.addColorStop(.45,"#ffcf9a"),l.addColorStop(1,"#f0986a"),M.fillStyle=l,M.beginPath(),M.arc(e,t,74,0,2*Math.PI),M.fill(),M.fillStyle="#f57ea7",M.fillRect(148,170,124,16),M.fillStyle="#ffe9f1",M.fillRect(148,196,124,14),M.fillStyle="#fff",M.beginPath(),M.arc(190,166,10,0,2*Math.PI),M.arc(230,166,10,0,2*Math.PI),M.fill(),M.fillStyle="#5a5a8b",M.beginPath(),M.arc(190,166,3.4,0,2*Math.PI),M.arc(230,166,3.4,0,2*Math.PI),M.fill(),M.fillStyle="#ffffff77",M.beginPath(),M.arc(190,150,16,0,2*Math.PI),M.fill(),M.strokeStyle="#8490d1",M.lineWidth=4,M.beginPath(),M.arc(e,194,18,.2,Math.PI-.2),M.stroke();const o=244,r=Math.max(0,I.boss.hp/h),c=Math.max(0,I.boss.timer/y);M.fillStyle="#ffffffc5",M.fillRect(88,60,o,14),M.fillStyle="#ff95cd",M.fillRect(88,60,o*r,14),M.fillStyle="#ffffffc5",M.fillRect(88,80,o,10),M.fillStyle="#8bc1ff",M.fillRect(88,80,o*c,10),M.fillStyle="#27402f",M.font="700 14px Baloo 2, Nunito, sans-serif",M.textAlign="center",M.fillText("Boss (Sweet Weakness)",210,52),M.font="700 13px Baloo 2, Nunito, sans-serif",M.fillText(u[I.snackLevel-1].name+"  DPS "+Math.round(I.boss.lastDps)+"/s",210,106),M.restore()}(),function(){M.save(),M.textAlign="center",M.font="700 18px Baloo 2, Nunito, sans-serif";for(let e=0;e<I.popups.length;e++){const t=I.popups[e];M.globalAlpha=Math.max(0,1-t.t/.9),M.fillStyle=t.color,M.fillText(t.text,210,t.y-14*e)}M.restore()}(),M.save(),M.fillStyle="#ffffffd9",M.fillRect(8,8,332,96),M.fillStyle="#27402f",M.font="700 14px Baloo 2, Nunito, sans-serif",M.fillText("Snack Lv "+I.snackLevel+" - "+u[I.snackLevel-1].name,16,26),M.fillText("Dist "+Math.floor(I.distance)+" / "+c+"   Score "+N(0),16,46),M.fillText("Throwers "+Math.max(1,Math.floor(I.party))+"   Mobs Purified "+I.mobsDefeated,16,66),M.fillText("젤리: 레벨업, 씨앗: 투척자+, 가시: 약화",16,86),M.restore()}async function K(a){const i=I.db;if(!i||!I.uid)throw new Error("auth_not_ready");const l=function(e){return String(e||"").trim().toLowerCase().replace(/\s+/g," ").slice(0,20)}(a);if(l.length<2)throw new Error("nickname_too_short");if(l.length>20)throw new Error("nickname_too_long");const o=I.nickKeyLower;if(o===l)return I.nick=a,void localStorage.setItem(t,a);const r=i.collection("games").doc(e);await i.runTransaction(async function(e){const t=r.collection("nicknames").doc(l),i=await e.get(t);if(i.exists&&i.data().uid!==I.uid)throw new Error("nickname_taken");if(e.set(t,{uid:I.uid,nick:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),o&&o!==l){const t=r.collection("nicknames").doc(o),n=await e.get(t);n.exists&&n.data().uid===I.uid&&e.delete(t)}const s=r.collection("players").doc(I.uid);e.set(s,{uid:I.uid,nick:a,bestRankValue:Number(localStorage.getItem(n)||0),bestRawValue:Number(localStorage.getItem(n)||0),updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}),I.nick=a,I.nickKeyLower=l,localStorage.setItem(t,a)}async function z(t,n,a){if(!I.db||!I.uid||!Number.isFinite(t))return;a||I.latestSubmitted&&I.latestSubmitted.score;const i=I.db.collection("games").doc(e),l=i.collection("leaderboard").doc(I.uid),o=i.collection("players").doc(I.uid);await I.db.runTransaction(async function(e){const i=await e.get(l),r=i.exists?Number(i.data().rankValue):null;if(null!==r&&t<r&&!a)return;e.set(l,{uid:I.uid,nick:I.nick,rankValue:t,rawValue:t,durationMs:n,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0});const s=await e.get(o),c=s.exists?Number(s.data().bestRankValue||0):0;e.set(o,{uid:I.uid,nick:I.nick,bestRankValue:Math.max(c,t),bestRawValue:Math.max(c,t),updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})})}async function X(){if(!I.db)return x.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Offline</span><strong>-</strong></li>",void(x.myRank.textContent="My Rank: Offline");const t=I.db.collection("games").doc(e).collection("leaderboard"),n=await t.orderBy("rankValue","desc").limit(10).get(),a=[];if(n.forEach(function(e,t){const n=e.data()||{},i=t+1,l=1===i?"rank-1":2===i?"rank-2":3===i?"rank-3":"",o=n.nick||"Anon",r=Number(n.rankValue||0);a.push("<li class='lb-item'><span class='"+l+"'>"+i+"</span><span>"+(String(o||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")+"</span><strong>")+r+"</strong></li>")}),0===a.length&&a.push("<li class='lb-item'><span>-</span><span>No entries yet</span><strong>0</strong></li>"),x.lbList.innerHTML=a.join(""),!I.uid)return void(x.myRank.textContent="My Rank: Sign-in pending");const i=await t.doc(I.uid).get();if(!i.exists)return void(x.myRank.textContent="My Rank: Unranked");const l=Number((i.data()||{}).rankValue||0),o=(await t.where("rankValue",">",l).get()).size+1;x.myRank.textContent="My Rank: #"+o+" | "+I.nick+" | "+l}function q(){I.modalOpen=!1,x.leaderboardModal.classList.remove("show")}function J(e){try{const t="string"==typeof e?JSON.parse(e):e;if(!t||!t.type)return;"REWARDED_GRANTED"===t.type?I.awaitingRevive&&(I.reviveUsed=!0,I.awaitingRevive=!1,I.modalOpen=!1,I.running=!0,I.distance=I.checkpointDistance,I.lane=I.checkpointLane,I.party=Math.max(2,I.party+2),I.purify+=8,I.hitFlash=0,C("Revived!","#fff09c"),x.reviveOverlay.classList.remove("show")):"REWARDED_DENIED"===t.type&&I.awaitingRevive&&F(!1,"Revive was not granted.")}catch(e){}}!function(){function e(e){if(I.modalOpen)return;const t=e.touches&&e.touches[0]?e.touches[0].clientX:e.clientX;null!=t&&D(function(e){const t=x.arena.getBoundingClientRect(),n=(e-t.left)/t.width;return n<.333?0:n>.666?2:1}(t))}x.arena.addEventListener("pointerdown",e,{passive:!0}),x.arena.addEventListener("pointermove",function(t){1===t.buttons&&e(t)},{passive:!0}),x.arena.addEventListener("touchstart",e,{passive:!0}),x.arena.addEventListener("touchmove",e,{passive:!0}),x.leftBtn.addEventListener("pointerdown",function(){D(I.lane-1)}),x.rightBtn.addEventListener("pointerdown",function(){D(I.lane+1)}),x.centerBtn.addEventListener("pointerdown",function(){D(1)}),window.addEventListener("keydown",function(e){"ArrowLeft"!==e.key&&"a"!==e.key||D(I.lane-1),"ArrowRight"!==e.key&&"d"!==e.key||D(I.lane+1),"ArrowDown"!==e.key&&"s"!==e.key||D(1)})}(),x.restartBtn.addEventListener("click",O),x.playAgainBtn.addEventListener("click",O),x.topBtn.addEventListener("click",function(){!async function(){I.modalOpen=!0,x.leaderboardModal.classList.add("show"),I.latestSubmitted&&(x.latestRun.style.display="block"),await X()}()}),x.closeLbBtn.addEventListener("click",q),x.reviveBtn.addEventListener("click",function(){B("REQUEST_REWARDED",{reason:"revive"})}),x.skipReviveBtn.addEventListener("click",function(){F(!1,"Skipped revive.")}),x.changeNickBtn.addEventListener("click",function(){x.nickInput.disabled=!1,x.saveNickBtn.style.display="inline-block",x.changeNickBtn.style.display="none",x.nickInput.focus()}),x.saveNickBtn.addEventListener("click",async function(){const e=(x.nickInput.value||"").trim();if(e.length<2)alert("Nickname must be at least 2 characters.");else try{await K(e),x.nickInput.disabled=!0,x.saveNickBtn.style.display="none",x.changeNickBtn.style.display="inline-block",await X()}catch(e){"nickname_taken"===String(e&&e.message)?alert("Nickname is already taken."):alert("Failed to save nickname.")}}),window.addEventListener("message",function(e){J(e.data)}),document.addEventListener("message",function(e){J(e.data)}),function(){try{const a={apiKey:"<api-key>",authDomain:"<project-id>.firebaseapp.com",projectId:"<project-id>",appId:"<app-id>"};if(!a.projectId||a.projectId.indexOf("<")>=0)throw new Error("firebase_placeholder");firebase.initializeApp(a),I.db=firebase.firestore();return firebase.auth().signInAnonymously().then(function(t){return I.uid=t.user.uid,I.db?I.db.collection("games").doc(e).set({gameId:e,name:"Sprout Lane Guardians",sortDirection:"desc",rankType:"score",updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}):Promise.resolve()}).then(async function(){const e=(localStorage.getItem(t)||"").trim()||L();try{await K(e)}catch(e){const t=L();await K(t)}x.nickInput.value=I.nick,await X();const a=Number(localStorage.getItem(n)||0);a>0&&await z(a,0,!0)}).catch(function(){I.db=null})}catch(e){return I.db=null,Promise.resolve()}}(),O(),requestAnimationFrame(function e(t){I.lastFrame||(I.lastFrame=t);const n=Math.min(.034,(t-I.lastFrame)/1e3);I.lastFrame=t,U(n),G(),requestAnimationFrame(e)})}()</script></body></html>