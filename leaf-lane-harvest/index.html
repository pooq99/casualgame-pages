<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="game-id" content="leaf-lane-harvest"><meta name="game-version" content="0.1.0"><title>Leaf Lane Harvest</title><style>:root{--bg:#f3eed9;--ink:#273019;--panel:#fff8e7;--accent:#2c9c54;--danger:#b5392f;--line:#cfbf8a;--gold:#cb9f28;--silver:#8794a0;--bronze:#99663f}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body{margin:0;min-height:100vh;background:radial-gradient(circle at 30% 15%,#fff8df 0,#efe5c6 55%,#e8ddb9 100%);font-family:"Trebuchet MS","Segoe UI",sans-serif;color:var(--ink);display:flex;justify-content:center;touch-action:manipulation;overflow:hidden}.app{width:min(100vw,520px);padding:10px;padding-top:calc(16px + env(safe-area-inset-top))}.topbar{display:grid;grid-template-columns:1fr 1fr auto auto;gap:8px;margin-bottom:8px}.pill{border:2px solid var(--line);border-radius:10px;background:#fffdf2d8;text-align:center;font-weight:700;font-size:14px;padding:8px 6px}button{border:none;border-radius:10px;padding:9px 10px;font-weight:700;background:var(--accent);color:#fff}#stageWrap{position:relative;border:3px solid #958350;border-radius:14px;overflow:hidden;background:linear-gradient(#8ec66f,#629543);box-shadow:inset 0 -50px 120px rgba(40,52,14,.25)}canvas{width:100%;height:auto;display:block}.hint{text-align:center;margin-top:6px;font-size:13px;opacity:.9;min-height:18px}.modal,.overlay{position:fixed;inset:0;background:rgba(17,24,9,.55);display:none;align-items:center;justify-content:center;padding:14px;z-index:9}.modal.show,.overlay.show{display:flex}.panel{width:min(100%,460px);background:var(--panel);border-radius:14px;border:2px solid #ddcd98;padding:14px}.panel h2{margin:0 0 8px;font-size:21px}.row{display:flex;align-items:center;gap:8px}.row-end{display:flex;justify-content:flex-end;gap:8px}input[type=text]{flex:1;border:2px solid #d8c792;border-radius:10px;padding:8px;font-size:14px;min-width:0}.lb-list{list-style:none;margin:10px 0;padding:0;border:1px solid #e5d7ab;border-radius:10px;max-height:280px;overflow:auto;background:#fffdf5}.lb-item{display:grid;grid-template-columns:34px 1fr auto;gap:8px;padding:7px 10px;border-bottom:1px solid #f0e6c6;font-size:14px}.lb-item:last-child{border-bottom:none}.rank-1{color:var(--gold);font-weight:800}.rank-2{color:var(--silver);font-weight:800}.rank-3{color:var(--bronze);font-weight:800}.my-rank{font-size:14px;background:#fff5d5;border:2px solid #edd08c;border-radius:10px;padding:8px 10px}</style></head><body><div class="app"><div class="topbar"><div class="pill">Score <span id="score">0</span></div><div class="pill">Best <span id="best">0</span></div><button id="topBtn">Top</button> <button id="restartBtn">Restart</button></div><div id="stageWrap"><canvas id="stage" width="420" height="760" aria-label="game field"></canvas></div><div id="hint" class="hint">Tap anywhere to switch lane.</div></div><div id="reviveOverlay" class="overlay"><div class="panel"><h2>Revive once?</h2><p id="reviveText">Watch rewarded ad in app wrapper to continue.</p><div class="row"><button id="reviveBtn">Revive</button> <button id="skipReviveBtn" style="background:#8d2f2f">No Thanks</button></div></div></div><div id="gameOverOverlay" class="overlay"><div class="panel"><h2>Harvest Ended</h2><p>Score: <strong id="finalScore">0</strong></p><p>Duration: <strong id="finalTime">0.00s</strong></p><div class="row"><button id="playAgainBtn">Play Again</button></div></div></div><div id="leaderboardModal" class="modal"><div class="panel"><h2>Global Top 10</h2><div id="latestRun" class="my-rank" style="display:none;margin-bottom:8px"></div><div class="row"><input id="nickInput" maxlength="20" disabled="disabled"> <button id="changeNickBtn">Change</button> <button id="saveNickBtn" style="display:none">Save</button></div><ul id="lbList" class="lb-list"></ul><div id="myRank" class="my-rank">My Rank: -</div><div class="row-end" style="margin-top:10px"><button id="closeLbBtn">Close</button></div></div></div><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script><script>!function(){"use strict";const e="leaf-lane-harvest",t="0.1.0",n="desc",a="score",i=e+":best",s=e+":nick",o=e+":interstitial:last",r={stage:document.getElementById("stage"),score:document.getElementById("score"),best:document.getElementById("best"),hint:document.getElementById("hint"),topBtn:document.getElementById("topBtn"),restartBtn:document.getElementById("restartBtn"),reviveOverlay:document.getElementById("reviveOverlay"),reviveBtn:document.getElementById("reviveBtn"),skipReviveBtn:document.getElementById("skipReviveBtn"),reviveText:document.getElementById("reviveText"),gameOverOverlay:document.getElementById("gameOverOverlay"),playAgainBtn:document.getElementById("playAgainBtn"),finalScore:document.getElementById("finalScore"),finalTime:document.getElementById("finalTime"),leaderboardModal:document.getElementById("leaderboardModal"),lbList:document.getElementById("lbList"),myRank:document.getElementById("myRank"),nickInput:document.getElementById("nickInput"),changeNickBtn:document.getElementById("changeNickBtn"),saveNickBtn:document.getElementById("saveNickBtn"),closeLbBtn:document.getElementById("closeLbBtn"),latestRun:document.getElementById("latestRun")},l=r.stage.getContext("2d"),c=[90,210,330],d={running:!1,modalOpen:!1,awaitingRevive:!1,reviveUsed:!1,startedSent:!1,lane:1,playerY:650,score:0,best:Number(localStorage.getItem(i)||0),elapsedMs:0,speed:190,speedTick:0,leafs:[],thorns:[],spawnCooldown:0,lastFrame:0,db:null,uid:null,nick:"",nickKeyLower:"",latestSubmitted:null};function u(e){return String(e||"").trim().toLowerCase().replace(/\s+/g," ").slice(0,20)}function m(e,t){const n=JSON.stringify({type:e,payload:t||{}});window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage&&window.ReactNativeWebView.postMessage(n)}function p(e){return(e/1e3).toFixed(2)+"s"}function y(){d.running=!0,d.modalOpen=!1,d.awaitingRevive=!1,d.reviveUsed=!1,d.startedSent=!1,d.lane=1,d.playerY=650,d.score=0,d.elapsedMs=0,d.speed=190,d.speedTick=0,d.leafs=[],d.thorns=[],d.spawnCooldown=0,r.score.textContent="0",r.hint.textContent="Tap anywhere to switch lane.",r.reviveOverlay.classList.remove("show"),r.gameOverOverlay.classList.remove("show"),r.latestRun.style.display="none"}function f(e,t,n,a){const i=c[d.lane]-22,s=d.playerY-22;return!(i+44<e||i>e+n||s+44<t||s>t+a)}function v(){d.reviveUsed?g():(d.running=!1,d.awaitingRevive=!0,d.modalOpen=!0,r.reviveText.textContent="Continue this run once via rewarded ad.",r.reviveOverlay.classList.add("show"))}function g(){d.running=!1,d.awaitingRevive=!1,d.modalOpen=!1,r.reviveOverlay.classList.remove("show"),r.gameOverOverlay.classList.add("show");const e=Math.max(1,Math.round(d.elapsedMs)),t=d.score;r.finalScore.textContent=String(t),r.finalTime.textContent=p(e),d.latestSubmitted={score:t,durationMs:e},r.latestRun.style.display="block",r.latestRun.textContent="Latest run: "+t+" points in "+p(e),m("GAME_OVER",{score:t,durationMs:e}),function(){try{const e=Date.now(),t=Number(localStorage.getItem(o)||0);return!(t&&e-t<35e3||(localStorage.setItem(o,String(e)),0))}catch(e){return!1}}()&&m("REQUEST_INTERSTITIAL",{reason:"run_completed"}),B(t,e,!1)}function k(e){if(!d.running)return;d.elapsedMs+=1e3*e,d.speedTick+=e,d.speedTick>=3&&(d.speedTick=0,d.speed+=14),d.spawnCooldown-=e,d.spawnCooldown<=0&&(!function(){const e=Math.floor(3*Math.random());for(let t=0;t<3;t++)t===e?Math.random()<.65&&d.leafs.push({lane:t,y:-30,size:22}):d.thorns.push({lane:t,y:-40,w:58,h:42})}(),d.spawnCooldown=Math.max(.33,.82-d.speed/700));const t=d.speed*e;for(const e of d.leafs)e.y+=t;for(const e of d.thorns)e.y+=t;for(const e of d.leafs){const t=c[e.lane]-.5*e.size,n=e.y-.5*e.size;!e.hit&&f(t,n,e.size,e.size)&&(e.hit=!0,d.score+=1,r.score.textContent=String(d.score),d.score>d.best&&(d.best=d.score,localStorage.setItem(i,String(d.best)),r.best.textContent=String(d.best)))}for(const e of d.thorns){if(f(c[e.lane]-.5*e.w,e.y-.5*e.h,e.w,e.h)){v();break}}d.leafs=d.leafs.filter(function(e){return e.y<820&&!e.hit}),d.thorns=d.thorns.filter(function(e){return e.y<850})}function b(e){const t=c[e.lane],n=e.y;l.save(),l.translate(t,n),l.fillStyle="#72c454",l.beginPath(),l.ellipse(0,0,12,9,-.4,0,2*Math.PI),l.fill(),l.strokeStyle="#437f2c",l.lineWidth=2,l.beginPath(),l.moveTo(-8,3),l.lineTo(8,-3),l.stroke(),l.restore()}function h(e){const t=c[e.lane],n=e.y;l.save(),l.translate(t,n),l.fillStyle="#8e4a2c",l.fillRect(-26,-18,52,34),l.fillStyle="#c2543d";for(let e=-20;e<=20;e+=10)l.beginPath(),l.moveTo(e,-18),l.lineTo(e+5,-30),l.lineTo(e+10,-18),l.closePath(),l.fill();l.restore()}function w(){l.clearRect(0,0,420,760),l.strokeStyle="rgba(41, 56, 19, 0.3)",l.lineWidth=4,l.beginPath(),l.moveTo(150,0),l.lineTo(150,760),l.moveTo(270,0),l.lineTo(270,760),l.stroke();for(const e of d.leafs)b(e);for(const e of d.thorns)h(e);!function(){const e=c[d.lane],t=d.playerY;l.save(),l.translate(e,t),l.fillStyle="#2a8f48",l.beginPath(),l.ellipse(0,2,24,20,-.2,0,2*Math.PI),l.fill(),l.fillStyle="#98d46b",l.beginPath(),l.ellipse(-6,-2,11,9,-.2,0,2*Math.PI),l.fill(),l.fillStyle="#375d1d",l.fillRect(10,-14,4,16),l.restore()}()}async function E(){if(!d.db||!d.uid)return;const t=u(d.nick);if(!t)return;const n=d.db,a=d.uid,i=d.nick,o=d.nickKeyLower;await n.runTransaction(async function(s){const r=n.collection("games").doc(e).collection("nicknames").doc(t),l=await s.get(r);if(l.exists&&l.data().uid!==a)throw new Error("Nickname already used");if(s.set(r,{uid:a,nick:i,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),o&&o!==t){const t=n.collection("games").doc(e).collection("nicknames").doc(o),i=await s.get(t);i.exists&&i.data().uid===a&&s.delete(t)}}),d.nickKeyLower=t,localStorage.setItem(s,i)}async function B(t,a,i){if(!d.db||!d.uid)return;const s=d.db,o=d.uid;try{const r=s.collection("games").doc(e),l=r.collection("leaderboard").doc(o),c=r.collection("players").doc(o);await s.runTransaction(async function(e){const s=await e.get(r),u=s.exists&&s.data().sortDirection||n,m=await e.get(l),p=m.exists?Number(m.data().rankValue):null;if(!i&&(y=u,f=t,null!=(v=p)&&!("asc"===y?f<v:f>v)))return;var y,f,v;const g={uid:o,nick:d.nick,rankValue:t,rawValue:t,durationMs:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()};e.set(l,g,{merge:!0}),e.set(c,{uid:o,nick:d.nick,bestRankValue:t,bestRawValue:t,durationMs:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}),await R()}catch(e){}}async function R(){if(!d.db)return r.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Offline</span><span>-</span></li>",void(r.myRank.textContent="My Rank: -");try{const t=d.db.collection("games").doc(e).collection("leaderboard"),n=await t.orderBy("rankValue","desc").limit(10).get(),a=[];let i=null,s=d.nick;if(n.forEach(function(e,t){const n=e.data()||{},o=t+1,r=1===o?"rank-1":2===o?"rank-2":3===o?"rank-3":"",l=n.nick||"Player",c=Number(n.rankValue||0);e.id===d.uid&&(i=c,s=l),a.push("<li class='lb-item'><span class='"+r+"'>"+o+"</span><span>"+(String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")+"</span><strong>")+c+"</strong></li>")}),r.lbList.innerHTML=a.length?a.join(""):"<li class='lb-item'><span>-</span><span>No scores yet</span><span>-</span></li>",d.uid){if(null===i){const e=await t.doc(d.uid).get();e.exists&&(i=Number((e.data()||{}).rankValue||0),s=(e.data()||{}).nick||s)}if(null===i)r.myRank.textContent="My Rank: Unranked";else{const e=(await t.where("rankValue",">",i).get()).size+1;r.myRank.textContent="My Rank: #"+e+" | "+s+" | "+i}}}catch(e){r.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Load failed</span><span>-</span></li>",r.myRank.textContent="My Rank: -"}}r.best.textContent=String(d.best),window.addEventListener("message",function(e){const t=e.data;t&&"object"==typeof t&&("REWARDED_GRANTED"===t.type&&t.payload&&"revive"===t.payload.rewardType&&d.awaitingRevive&&(d.reviveUsed=!0,d.awaitingRevive=!1,d.modalOpen=!1,d.running=!0,d.thorns=d.thorns.filter(function(e){return e.y<d.playerY-140||e.y>d.playerY+140}),r.reviveOverlay.classList.remove("show"),r.hint.textContent="Revived. Keep harvesting."),"REWARDED_DENIED"===t.type&&d.awaitingRevive&&g())}),r.stage.addEventListener("pointerdown",function(){d.modalOpen||(!d.startedSent&&d.running&&(d.startedSent=!0,m("GAME_START",{})),d.running&&(d.lane=(d.lane+1)%3))}),r.restartBtn.addEventListener("click",y),r.playAgainBtn.addEventListener("click",y),r.topBtn.addEventListener("click",function(){d.modalOpen=!0,r.leaderboardModal.classList.add("show"),d.latestSubmitted&&(r.latestRun.style.display="block",r.latestRun.textContent="Latest run: "+d.latestSubmitted.score+" points"),R()}),r.closeLbBtn.addEventListener("click",function(){r.leaderboardModal.classList.remove("show"),d.modalOpen=!1}),r.reviveBtn.addEventListener("click",function(){d.awaitingRevive&&(m("REQUEST_REWARDED",{reason:"revive"}),r.reviveText.textContent="Waiting for reward result...")}),r.skipReviveBtn.addEventListener("click",g),r.changeNickBtn.addEventListener("click",function(){r.nickInput.disabled=!1,r.nickInput.focus(),r.changeNickBtn.style.display="none",r.saveNickBtn.style.display="inline-block"}),r.saveNickBtn.addEventListener("click",async function(){const e=String(r.nickInput.value||"").trim().slice(0,20);if(!e)return;const t=d.nick,n=d.nickKeyLower;d.nick=e;try{await E(),r.nickInput.disabled=!0,r.changeNickBtn.style.display="inline-block",r.saveNickBtn.style.display="none",await R(),d.latestSubmitted&&await B(d.latestSubmitted.score,d.latestSubmitted.durationMs,!0)}catch(e){d.nick=t,d.nickKeyLower=n,r.nickInput.value=t,alert("Nickname already in use.")}}),y(),async function(){const i=window.FIREBASE_CONFIG||{apiKey:"<api-key>",authDomain:"<project-id>.firebaseapp.com",projectId:"<project-id>",appId:"<app-id>"};if(!Object.keys(i).some(function(e){return String(i[e]).indexOf("<")>=0}))try{firebase.initializeApp(i),d.db=firebase.firestore();const o=firebase.auth(),l=localStorage.getItem(s);d.nick=l&&l.trim()?l.trim():function(){const e="23456789";return"Leaf"+"ABCDEFGHJKLMNPQRSTUVWXYZ"[Math.floor(24*Math.random())]+e[Math.floor(8*Math.random())]+e[Math.floor(8*Math.random())]}(),localStorage.setItem(s,d.nick),d.nickKeyLower=u(d.nick),r.nickInput.value=d.nick,o.onAuthStateChanged(async function(i){if(i){d.uid=i.uid;try{await async function(){if(!d.db)return;const i=d.db.collection("games").doc(e);await i.set({sortDirection:n,rankType:a,version:t,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}(),await E(),await R()}catch(e){}}}),await o.signInAnonymously()}catch(e){}}(),requestAnimationFrame(function e(t){d.lastFrame||(d.lastFrame=t);const n=Math.min(.033,(t-d.lastFrame)/1e3);d.lastFrame=t,k(n),w(),requestAnimationFrame(e)})}()</script></body></html>