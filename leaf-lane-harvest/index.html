<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><meta name="game-id" content="leaf-lane-harvest"><meta name="game-version" content="0.2.5"><title>Leaf Lane Harvest</title><style>:root{--bg:#e7f3d1;--ink:#1f2d19;--panel:#fff9e8;--accent:#2e8a4f;--danger:#9f3530;--line:#b7d08b;--gold:#cb9f28;--silver:#8897a6;--bronze:#9d6c48}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}body,html{overscroll-behavior:none}body{margin:0;min-height:100vh;background:radial-gradient(circle at 30% 20%,#f7ffe7 0,#e9f3d3 58%,#dce9be 100%);font-family:"Trebuchet MS","Segoe UI",sans-serif;color:var(--ink);display:flex;justify-content:center;overflow:hidden;touch-action:none}.app{width:min(100vw,520px);padding:10px;padding-top:calc(14px + env(safe-area-inset-top))}.topbar{display:grid;grid-template-columns:1fr 1fr auto auto;gap:8px;margin-bottom:8px}.pill{border:2px solid var(--line);border-radius:10px;background:#fffef5d9;text-align:center;font-weight:700;font-size:14px;padding:8px 6px}button{border:none;border-radius:10px;padding:9px 10px;font-weight:700;background:var(--accent);color:#fff;cursor:pointer}#stageWrap{position:relative;border:3px solid #7f9f57;border-radius:14px;overflow:hidden;background:linear-gradient(#9cd370,#7dbc59);box-shadow:inset 0 -40px 120px rgba(33,52,16,.25);touch-action:none;user-select:none;-webkit-user-select:none}canvas{width:100%;height:auto;display:block;touch-action:none}.hint{min-height:18px;text-align:center;margin-top:6px;font-size:13px;opacity:.9}.modal,.overlay{position:fixed;inset:0;background:rgba(17,24,9,.58);display:none;align-items:center;justify-content:center;padding:14px;z-index:10}.modal.show,.overlay.show{display:flex}.panel{width:min(100%,460px);background:var(--panel);border-radius:14px;border:2px solid #dac892;padding:14px}.panel h2{margin:0 0 8px;font-size:21px}.row{display:flex;align-items:center;gap:8px}.row-end{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}input[type=text]{flex:1;border:2px solid #d5c38e;border-radius:10px;padding:8px;font-size:14px;min-width:0}.lb-list{list-style:none;margin:10px 0;padding:0;border:1px solid #e8dbb4;border-radius:10px;max-height:280px;overflow:auto;background:#fffdf4}.lb-item{display:grid;grid-template-columns:34px 1fr auto;gap:8px;padding:7px 10px;border-bottom:1px solid #f2e8cc;font-size:14px}.lb-item:last-child{border-bottom:none}.rank-1{color:var(--gold);font-weight:800}.rank-2{color:var(--silver);font-weight:800}.rank-3{color:var(--bronze);font-weight:800}.my-rank{font-size:14px;background:#fff5d6;border:2px solid #efd290;border-radius:10px;padding:8px 10px}</style></head><body><div class="app"><div class="topbar"><div class="pill">Height <span id="score">0</span>m</div><div class="pill">Best <span id="best">0</span>m</div><button id="topBtn">Top</button> <button id="restartBtn">Restart</button></div><div id="stageWrap"><canvas id="stage" width="420" height="760" aria-label="game field"></canvas></div><div id="hint" class="hint">Tap left/right half to steer while auto-jumping.</div></div><div id="reviveOverlay" class="overlay"><div class="panel"><h2>Revive once?</h2><p id="reviveText">Use rewarded ad in wrapper to continue.</p><div class="row"><button id="reviveBtn">Revive</button> <button id="skipReviveBtn" style="background:#8f322f">No Thanks</button></div></div></div><div id="gameOverOverlay" class="overlay"><div class="panel"><h2>Climb Ended</h2><p>Height: <strong id="finalScore">0</strong>m</p><p>Duration: <strong id="finalTime">0.00s</strong></p><div class="row"><button id="playAgainBtn">Play Again</button></div></div></div><div id="leaderboardModal" class="modal"><div class="panel"><h2>Global Top 10</h2><div id="latestRun" class="my-rank" style="display:none;margin-bottom:8px"></div><div class="row"><input id="nickInput" maxlength="20" disabled="disabled"> <button id="changeNickBtn">Change</button> <button id="saveNickBtn" style="display:none">Save</button></div><ul id="lbList" class="lb-list"></ul><div id="myRank" class="my-rank">My Rank: -</div><div class="row-end"><button id="closeLbBtn">Close</button></div></div></div><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script><script>!function(){"use strict";const e="leaf-lane-harvest",t="0.2.5",n="desc",a="score",i=e+":best",s=e+":nick",o=e+":interstitial:last",r=420,l=760,c=-730,d={stage:document.getElementById("stage"),score:document.getElementById("score"),best:document.getElementById("best"),hint:document.getElementById("hint"),topBtn:document.getElementById("topBtn"),restartBtn:document.getElementById("restartBtn"),reviveOverlay:document.getElementById("reviveOverlay"),reviveBtn:document.getElementById("reviveBtn"),skipReviveBtn:document.getElementById("skipReviveBtn"),reviveText:document.getElementById("reviveText"),gameOverOverlay:document.getElementById("gameOverOverlay"),playAgainBtn:document.getElementById("playAgainBtn"),finalScore:document.getElementById("finalScore"),finalTime:document.getElementById("finalTime"),leaderboardModal:document.getElementById("leaderboardModal"),lbList:document.getElementById("lbList"),myRank:document.getElementById("myRank"),nickInput:document.getElementById("nickInput"),changeNickBtn:document.getElementById("changeNickBtn"),saveNickBtn:document.getElementById("saveNickBtn"),closeLbBtn:document.getElementById("closeLbBtn"),latestRun:document.getElementById("latestRun")},u=d.stage.getContext("2d"),p={running:!1,modalOpen:!1,awaitingRevive:!1,reviveUsed:!1,startedSent:!1,elapsedMs:0,score:0,best:Number(localStorage.getItem(i)||0),worldY:0,speedScale:1,player:{x:210,y:560,w:34,h:36,vx:0,vy:0,facing:1},platforms:[],bugs:[],leaves:[],spawnTopY:540,lastSpawnCenterX:210,inputDir:0,inputTimer:0,invuln:0,lastFrame:0,db:null,uid:null,nick:"",nickKeyLower:"",latestSubmitted:null};function f(e){return String(e||"").trim().toLowerCase().replace(/\s+/g," ").slice(0,20)}function m(e,t){const n=JSON.stringify({type:e,payload:t||{}});window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage&&window.ReactNativeWebView.postMessage(n)}function y(e){return(e/1e3).toFixed(2)+"s"}function v(e,t){return e+Math.random()*(t-e)}function g(e,t){const n=v(102,154),a=r-n-16;let i;if("number"==typeof t){i=(s=t+v(-58,58),o=16+.5*n,l=a+.5*n,Math.max(o,Math.min(l,s)))-.5*n}else i=v(16,a);var s,o,l;return{x:i,y:e,w:n,h:14}}function w(e){return{x:v(30,390),y:e,w:28,h:20,vx:(Math.random()<.5?-1:1)*v(18,40)}}function h(e){return{x:v(22,398),y:e,r:10,taken:!1}}function b(){p.running=!0,p.modalOpen=!1,p.awaitingRevive=!1,p.reviveUsed=!1,p.startedSent=!1,p.elapsedMs=0,p.score=0,p.worldY=0,p.speedScale=1,p.lastSpawnCenterX=210,p.inputDir=0,p.inputTimer=0,p.invuln=0,p.scoreShown=0,p.player.x=210,p.player.y=560,p.player.w=34,p.player.h=36,p.player.vx=0,p.player.vy=c,p.player.facing=1,function(){p.platforms=[],p.bugs=[],p.leaves=[],p.spawnTopY=640,p.lastSpawnCenterX=p.player.x;for(let e=0;e<18;e++){p.spawnTopY-=v(34,46);const t=g(p.spawnTopY,p.lastSpawnCenterX);p.platforms.push(t),p.lastSpawnCenterX=t.x+.5*t.w,Math.random()<.12&&e>2&&p.bugs.push(w(p.spawnTopY-16)),Math.random()<.52&&p.leaves.push(h(p.spawnTopY-30))}}(),d.score.textContent="0",d.hint.textContent="Tap left/right half to steer while auto-jumping.",d.reviveOverlay.classList.remove("show"),d.gameOverOverlay.classList.remove("show"),d.latestRun.style.display="none"}function k(){b()}function x(){p.reviveUsed?S():(p.running=!1,p.awaitingRevive=!0,p.modalOpen=!0,d.reviveText.textContent="Continue this run once via rewarded ad.",d.reviveOverlay.classList.add("show"))}function S(){p.running=!1,p.awaitingRevive=!1,p.modalOpen=!1,d.reviveOverlay.classList.remove("show"),d.gameOverOverlay.classList.add("show");const e=Math.max(1,Math.round(p.elapsedMs)),t=p.score;d.finalScore.textContent=String(t),d.finalTime.textContent=y(e),p.latestSubmitted={score:t,durationMs:e},d.latestRun.style.display="block",d.latestRun.textContent="Latest run: "+t+"m in "+y(e),m("GAME_OVER",{score:t,durationMs:e}),function(){try{const e=Date.now(),t=Number(localStorage.getItem(o)||0);return!(t&&e-t<35e3||(localStorage.setItem(o,String(e)),0))}catch(e){return!1}}()&&m("REQUEST_INTERSTITIAL",{reason:"run_completed"}),C(t,e,!1)}function E(e,t){return!(e.x+e.w<t.x||e.x>t.x+t.w||e.y+e.h<t.y||e.y>t.y+t.h)}function T(e){if(!p.running)return;p.elapsedMs+=1e3*e,p.speedScale=Math.min(1.9,1+p.elapsedMs/36e3),p.invuln>0&&(p.invuln=Math.max(0,p.invuln-e));const t=p.player,n=t.y;p.inputTimer>0?p.inputTimer-=e:p.inputDir=0;t.vx=300*p.inputDir,0!==t.vx&&(t.facing=t.vx>0?1:-1),t.vy+=1260*e,t.x+=t.vx*e,t.y+=t.vy*e,t.x<.5*t.w&&(t.x=.5*t.w),t.x>r-.5*t.w&&(t.x=r-.5*t.w);const a={x:t.x-.5*t.w,y:t.y-.5*t.h,w:t.w,h:t.h};if(t.vy>0)for(let e=0;e<p.platforms.length;e++){const i=p.platforms[e],s={x:i.x,y:i.y,w:i.w,h:i.h};if(n+.5*t.h<=i.y+4&&E(a,s)){t.y=i.y-.5*t.h,t.vy=c;break}}let s=76*p.speedScale*e;if(t.y<288.8){const n=2.2*(288.8-t.y)*e;s+=n,t.y+=n,p.worldY+=.18*n}for(const e of p.platforms)e.y+=s;for(const t of p.bugs)t.y+=s,t.x+=t.vx*e*p.speedScale,t.x<20&&(t.x=20,t.vx*=-1),t.x>400&&(t.x=400,t.vx*=-1);for(const e of p.leaves)e.y+=s;!function(){let e=0;for(;p.platforms.length<28&&e<80;){p.spawnTopY-=v(34,46);const t=g(p.spawnTopY,p.lastSpawnCenterX);p.platforms.push(t),p.lastSpawnCenterX=t.x+.5*t.w,Math.random()<.1&&p.bugs.push(w(p.spawnTopY-16)),Math.random()<.5&&p.leaves.push(h(p.spawnTopY-28)),e+=1}}(),p.platforms=p.platforms.filter(function(e){return e.y<820}),p.bugs=p.bugs.filter(function(e){return e.y<820}),p.leaves=p.leaves.filter(function(e){return e.y<800&&!e.taken});const o={x:t.x-12,y:t.y-14,w:24,h:28};if(p.invuln<=0)for(const e of p.bugs){if(E(o,{x:e.x-.5*e.w,y:e.y-.5*e.h,w:e.w,h:e.h})){x();break}}for(const e of p.leaves){const n=e.x-t.x,a=e.y-t.y;n*n+a*a<484&&(e.taken=!0,p.score+=3)}const l=Math.max(0,Math.floor(.07*p.worldY))+p.score;l!==p.scoreShown&&(p.scoreShown=l,d.score.textContent=String(l),l>p.best&&(p.best=l,localStorage.setItem(i,String(p.best)),d.best.textContent=String(p.best))),t.y>890?(p.score=p.scoreShown||0,x()):p.score=p.scoreShown||0}function B(e){u.fillStyle="#4f8d31",u.fillRect(e.x,e.y,e.w,e.h),u.fillStyle="#7dc652",u.fillRect(e.x+4,e.y+2,e.w-8,6)}function M(e){u.save(),u.translate(e.x,e.y),u.fillStyle="#8f432e",u.beginPath(),u.ellipse(0,0,12,9,0,0,2*Math.PI),u.fill(),u.fillStyle="#c35d3d",u.beginPath(),u.moveTo(-8,-5),u.lineTo(-2,-15),u.lineTo(2,-5),u.closePath(),u.fill(),u.beginPath(),u.moveTo(2,-5),u.lineTo(8,-15),u.lineTo(12,-5),u.closePath(),u.fill(),u.restore()}function R(e){u.save(),u.translate(e.x,e.y),u.fillStyle="#70c452",u.beginPath(),u.ellipse(0,0,11,8,-.35,0,2*Math.PI),u.fill(),u.strokeStyle="#3d7a28",u.lineWidth=2,u.beginPath(),u.moveTo(-7,3),u.lineTo(7,-2),u.stroke(),u.restore()}function I(){u.clearRect(0,0,r,l),function(){u.fillStyle="rgba(255,255,255,0.24)";const e=.02*p.elapsedMs%120;for(let t=-2;t<8;t++){const n=120*t+e;u.beginPath(),u.ellipse(90,n,70,24,0,0,2*Math.PI),u.ellipse(260,n+30,86,28,0,0,2*Math.PI),u.fill()}}();for(const e of p.platforms)B(e);for(const e of p.leaves)R(e);for(const e of p.bugs)M(e);!function(){const e=p.player;u.save(),u.translate(e.x,e.y),p.invuln>0&&Math.floor(16*p.invuln)%2==0&&(u.globalAlpha=.45),u.scale(e.facing,1),u.fillStyle="#315f24",u.fillRect(-9,-18,18,24),u.fillStyle="#ffe4bf",u.beginPath(),u.arc(0,-22,10,0,2*Math.PI),u.fill(),u.fillStyle="#2f7f46",u.beginPath(),u.moveTo(-11,-30),u.lineTo(10,-36),u.lineTo(7,-16),u.lineTo(-10,-18),u.closePath(),u.fill(),u.restore()}()}async function L(){if(!p.db||!p.uid)return;const t=f(p.nick);if(!t)return;const n=p.db,a=p.uid,i=p.nick,o=p.nickKeyLower;await n.runTransaction(async function(s){const r=n.collection("games").doc(e).collection("nicknames").doc(t),l=await s.get(r);if(l.exists&&l.data().uid!==a)throw new Error("Nickname already used");if(s.set(r,{uid:a,nick:i,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),o&&o!==t){const t=n.collection("games").doc(e).collection("nicknames").doc(o),i=await s.get(t);i.exists&&i.data().uid===a&&s.delete(t)}}),p.nickKeyLower=t,localStorage.setItem(s,i)}async function C(t,a,i){if(!p.db||!p.uid)return;const s=p.db,o=p.uid;try{const r=s.collection("games").doc(e),l=r.collection("leaderboard").doc(o),c=r.collection("players").doc(o);await s.runTransaction(async function(e){const s=await e.get(r),d=s.exists&&s.data().sortDirection||n,u=await e.get(l),f=u.exists?Number(u.data().rankValue):null;if(!i&&(m=d,y=t,null!=(v=f)&&!("asc"===m?y<v:y>v)))return;var m,y,v;const g={uid:o,nick:p.nick,rankValue:t,rawValue:t,durationMs:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()};e.set(l,g,{merge:!0}),e.set(c,{uid:o,nick:p.nick,bestRankValue:t,bestRawValue:t,durationMs:a,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}),await O()}catch(e){}}async function O(){if(!p.db)return d.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Offline</span><span>-</span></li>",void(d.myRank.textContent="My Rank: -");try{const t=p.db.collection("games").doc(e).collection("leaderboard"),n=await t.orderBy("rankValue","desc").limit(10).get(),a=[];let i=null,s=p.nick;if(n.forEach(function(e,t){const n=e.data()||{},o=t+1,r=1===o?"rank-1":2===o?"rank-2":3===o?"rank-3":"",l=n.nick||"Player",c=Number(n.rankValue||0);e.id===p.uid&&(i=c,s=l),a.push("<li class='lb-item'><span class='"+r+"'>"+o+"</span><span>"+(String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;")+"</span><strong>")+c+"</strong></li>")}),d.lbList.innerHTML=a.length?a.join(""):"<li class='lb-item'><span>-</span><span>No scores yet</span><span>-</span></li>",p.uid){if(null===i){const e=await t.doc(p.uid).get();e.exists&&(i=Number((e.data()||{}).rankValue||0),s=(e.data()||{}).nick||s)}if(null===i)d.myRank.textContent="My Rank: Unranked";else{const e=(await t.where("rankValue",">",i).get()).size+1;d.myRank.textContent="My Rank: #"+e+" | "+s+" | "+i}}}catch(e){d.lbList.innerHTML="<li class='lb-item'><span>-</span><span>Load failed</span><span>-</span></li>",d.myRank.textContent="My Rank: -"}}function N(e){e&&"object"==typeof e&&("REWARDED_GRANTED"===e.type&&e.payload&&"revive"===e.payload.rewardType&&p.awaitingRevive&&(p.reviveUsed=!0,p.awaitingRevive=!1,p.modalOpen=!1,p.running=!0,p.invuln=1.6,p.player.vy=-620.5,d.reviveOverlay.classList.remove("show"),d.hint.textContent="Revived. Keep climbing."),"REWARDED_DENIED"===e.type&&p.awaitingRevive&&S())}p.scoreShown=0,d.best.textContent=String(p.best),window.addEventListener("message",function(e){let t=e.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return}N(t)}),document.addEventListener("message",function(e){let t=e.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return}N(t)}),d.stage.addEventListener("pointerdown",function(e){e.preventDefault(),function(e){if(p.modalOpen)return;if(!p.startedSent&&p.running&&(p.startedSent=!0,m("GAME_START",{})),!p.running)return;const t=d.stage.getBoundingClientRect(),n=e-t.left;p.inputDir=n<.5*t.width?-1:1,p.inputTimer=.36}(e.clientX)}),d.stage.addEventListener("pointermove",function(e){e.preventDefault()}),document.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),d.restartBtn.addEventListener("click",k),d.playAgainBtn.addEventListener("click",k),d.topBtn.addEventListener("click",function(){p.modalOpen=!0,d.leaderboardModal.classList.add("show"),p.latestSubmitted&&(d.latestRun.style.display="block",d.latestRun.textContent="Latest run: "+p.latestSubmitted.score+"m"),O()}),d.closeLbBtn.addEventListener("click",function(){d.leaderboardModal.classList.remove("show"),p.modalOpen=!1}),d.reviveBtn.addEventListener("click",function(){p.awaitingRevive&&(m("REQUEST_REWARDED",{reason:"revive"}),d.reviveText.textContent="Waiting for reward result...")}),d.skipReviveBtn.addEventListener("click",S),d.changeNickBtn.addEventListener("click",function(){d.nickInput.disabled=!1,d.nickInput.focus(),d.changeNickBtn.style.display="none",d.saveNickBtn.style.display="inline-block"}),d.saveNickBtn.addEventListener("click",async function(){const e=String(d.nickInput.value||"").trim().slice(0,20);if(!e)return;const t=p.nick,n=p.nickKeyLower;p.nick=e;try{await L(),d.nickInput.disabled=!0,d.changeNickBtn.style.display="inline-block",d.saveNickBtn.style.display="none",await O(),p.latestSubmitted&&await C(p.latestSubmitted.score,p.latestSubmitted.durationMs,!0)}catch(e){p.nick=t,p.nickKeyLower=n,d.nickInput.value=t,alert("Nickname already in use.")}}),k(),async function(){const i=window.FIREBASE_CONFIG||{apiKey:"<api-key>",authDomain:"<project-id>.firebaseapp.com",projectId:"<project-id>",appId:"<app-id>"};if(!Object.keys(i).some(function(e){return String(i[e]).indexOf("<")>=0}))try{firebase.initializeApp(i),p.db=firebase.firestore();const o=firebase.auth(),r=localStorage.getItem(s);p.nick=r&&r.trim()?r.trim():function(){const e="23456789";return"Leaf"+"ABCDEFGHJKLMNPQRSTUVWXYZ"[Math.floor(24*Math.random())]+e[Math.floor(8*Math.random())]+e[Math.floor(8*Math.random())]}(),localStorage.setItem(s,p.nick),p.nickKeyLower=f(p.nick),d.nickInput.value=p.nick,o.onAuthStateChanged(async function(i){if(i){p.uid=i.uid;try{await async function(){if(!p.db)return;const i=p.db.collection("games").doc(e);await i.set({sortDirection:n,rankType:a,version:t,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}(),await L(),await O()}catch(e){}}}),await o.signInAnonymously()}catch(e){}}(),requestAnimationFrame(function e(t){p.lastFrame||(p.lastFrame=t);const n=Math.min(.033,(t-p.lastFrame)/1e3);p.lastFrame=t,T(n),I(),requestAnimationFrame(e)})}()</script></body></html>